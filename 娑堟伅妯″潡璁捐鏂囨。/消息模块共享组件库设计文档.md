# 📚 消息模块共享组件库设计文档

> **15个核心共享组件的完整设计规范**
> 
> 版本：v1.0 | 创建时间：2025-09-29 | 技术栈：Expo React Native + TypeScript
> 设计标准：UNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.4

---

## 📋 **组件库概览**

### 🎯 **设计目标**
- **组件复用率**：90%+
- **接口一致性**：统一的Props设计模式
- **类型安全**：完整的TypeScript类型定义
- **性能优化**：支持懒加载和虚拟化

### 📊 **组件分类统计**
- **高复用组件**：7个 (90%+复用率)
- **中等复用组件**：4个 (60-80%复用率)
- **专用组件**：3个 (单页面使用)
- **工具组件**：1个 (动画包装)

---

## 🔥 **高复用组件设计 (90%+复用率)**

### 📋 **1. MessageListItem - 消息列表项组件**

**📍 复用页面**: 主页面、赞和收藏、评论、粉丝、系统通知页面 (5/7页面)

#### 🎯 **核心功能**
- 统一的消息列表项UI结构
- 支持多种消息类型的数据适配
- 内置点击交互和长按菜单
- 支持未读状态和时间显示

#### 📋 **Props接口设计**
```typescript
interface MessageListItemProps {
  // 基础数据
  id: string
  type: 'conversation' | 'like' | 'comment' | 'follow' | 'notification'
  
  // 用户信息
  user: {
    id: string
    nickname: string
    avatar: string
    onlineStatus?: 'online' | 'offline' | 'away'
  }
  
  // 消息内容
  content: {
    text?: string
    preview?: string
    mediaUrl?: string
    mediaType?: 'image' | 'video' | 'audio'
  }
  
  // 状态信息
  status: {
    isRead: boolean
    timestamp: number
    unreadCount?: number
    actionType?: string // "点赞了你的评论"、"关注了你"等
  }
  
  // 交互配置
  interactions: {
    onPress?: () => void
    onLongPress?: () => void
    onAvatarPress?: () => void
    onContentPress?: () => void
  }
  
  // 显示配置
  display: {
    showUnreadBadge?: boolean
    showTimestamp?: boolean
    showActionIcon?: boolean
    showContentPreview?: boolean
  }
}
```

#### 🎨 **设计规范**
- **容器**: 高度80-100px，白色背景，底部1px分隔线
- **布局**: 左侧头像(48x48px) + 中央信息区域 + 右侧状态区域
- **字体**: 昵称16sp粗体，内容14sp常规，时间12sp
- **颜色**: 未读消息加粗显示，已读消息常规显示

#### 🔄 **状态适配**
```typescript
// 根据type自动适配不同消息类型的显示
const getDisplayConfig = (type: MessageType) => {
  switch (type) {
    case 'conversation':
      return { showUnreadBadge: true, showTimestamp: true }
    case 'like':
      return { showActionIcon: true, showContentPreview: true }
    case 'comment':
      return { showActionIcon: true, showContentPreview: true }
    case 'follow':
      return { showActionIcon: true, showTimestamp: true }
    case 'notification':
      return { showTimestamp: true, showContentPreview: true }
  }
}
```

---

### 👤 **2. UserAvatar - 用户头像组件**

**📍 复用页面**: 所有页面 (7/7页面)

#### 🎯 **核心功能**
- 支持多种尺寸的圆形头像显示
- 在线状态指示器
- 未读消息角标
- 操作类型图标overlay

#### 📋 **Props接口设计**
```typescript
interface UserAvatarProps {
  // 用户信息
  user: {
    id: string
    avatar: string
    nickname: string
  }
  
  // 尺寸配置
  size: 'small' | 'medium' | 'large' | number // 24/36/48px 或自定义
  
  // 状态指示
  status?: {
    online?: 'online' | 'offline' | 'away'
    unreadCount?: number
    actionType?: 'like' | 'comment' | 'follow' | 'system'
  }
  
  // 交互配置
  onPress?: () => void
  onLongPress?: () => void
  
  // 样式配置
  style?: {
    borderWidth?: number
    borderColor?: string
    showShadow?: boolean
  }
}
```

#### 🎨 **设计规范**
- **尺寸**: small(24px), medium(36px), large(48px)
- **边框**: 2px白色边框，可选阴影效果
- **在线状态**: 右下角绿色圆点(6px)
- **未读角标**: 右上角红色圆形，14x14px，白色数字
- **操作图标**: 右下角彩色图标，16x16px

#### 🔄 **状态映射**
```typescript
const getStatusIndicator = (status) => {
  return {
    online: <OnlineIndicator color="#00C851" />,
    offline: null,
    away: <OnlineIndicator color="#FF8800" />
  }
}

const getActionIcon = (actionType) => {
  return {
    like: <HeartIcon color="#FF69B4" />,
    comment: <CommentIcon color="#4A90E2" />,
    follow: <UserIcon color="#FF8C00" />,
    system: <BellIcon color="#5856D6" />
  }
}
```

---

### 🧭 **3. NavigationBar - 导航栏组件**

**📍 复用页面**: 除主页面外所有页面 (6/7页面)

#### 🎯 **核心功能**
- 统一的页面导航栏UI
- 支持返回按钮、标题、右侧功能按钮
- 适配安全区域

#### 📋 **Props接口设计**
```typescript
interface NavigationBarProps {
  // 标题配置
  title: string
  subtitle?: string
  
  // 左侧配置
  left?: {
    type: 'back' | 'close' | 'custom'
    icon?: ReactNode
    onPress?: () => void
  }
  
  // 右侧配置
  right?: {
    type: 'text' | 'icon' | 'custom'
    text?: string
    icon?: ReactNode
    onPress?: () => void
    disabled?: boolean
  }
  
  // 样式配置
  style?: {
    backgroundColor?: string
    textColor?: string
    height?: number
  }
}
```

#### 🎨 **设计规范**
- **高度**: 56px + 安全区域
- **布局**: 左侧按钮(44x44px) + 中央标题 + 右侧按钮(44x44px)
- **字体**: 标题18sp粗体，副标题14sp常规
- **背景**: 白色背景，底部可选分隔线

---

### 🔘 **4. ActionButton - 操作按钮组件**

**📍 复用页面**: 粉丝页面、确认对话框、系统通知页面 (3/7页面)

#### 🎯 **核心功能**
- 支持多种按钮状态和样式
- 内置加载状态和禁用状态
- 统一的交互反馈

#### 📋 **Props接口设计**
```typescript
interface ActionButtonProps {
  // 基础配置
  text: string
  variant: 'primary' | 'secondary' | 'outline' | 'text'
  size: 'small' | 'medium' | 'large'
  
  // 状态配置
  loading?: boolean
  disabled?: boolean
  
  // 特殊状态 (用于关注按钮)
  followState?: 'follow' | 'following' | 'mutual'
  
  // 交互配置
  onPress: () => void
  onLongPress?: () => void
  
  // 样式配置
  style?: {
    width?: number | string
    backgroundColor?: string
    textColor?: string
    borderRadius?: number
  }
}
```

#### 🎨 **设计规范**
- **主要按钮**: 紫色背景#8A2BE2，白色文字
- **次要按钮**: 灰色边框，灰色文字
- **尺寸**: small(60x28px), medium(80x32px), large(100x36px)
- **圆角**: 16px(small), 18px(medium), 20px(large)

---

### ⏳ **5. LoadingIndicator - 加载指示器组件**

**📍 复用页面**: 所有页面 (7/7页面)

#### 🎯 **核心功能**
- 统一的加载状态展示
- 支持多种加载样式
- 可配置加载文本

#### 📋 **Props接口设计**
```typescript
interface LoadingIndicatorProps {
  // 类型配置
  type: 'spinner' | 'dots' | 'pulse' | 'skeleton'
  
  // 尺寸配置
  size: 'small' | 'medium' | 'large'
  
  // 文本配置
  text?: string
  showText?: boolean
  
  // 样式配置
  color?: string
  backgroundColor?: string
  
  // 容器配置
  fullScreen?: boolean
  overlay?: boolean
}
```

---

### 📭 **6. EmptyState - 空状态组件**

**📍 复用页面**: 所有列表页面 (6/7页面)

#### 🎯 **核心功能**
- 统一的空状态提示界面
- 支持自定义图标和文案
- 可配置操作按钮

#### 📋 **Props接口设计**
```typescript
interface EmptyStateProps {
  // 内容配置
  icon?: ReactNode
  title: string
  description?: string
  
  // 动作配置
  action?: {
    text: string
    onPress: () => void
  }
  
  // 样式配置
  style?: {
    iconSize?: number
    textColor?: string
    backgroundColor?: string
  }
}
```

---

### 🕐 **7. TimeStamp - 时间戳组件**

**📍 复用页面**: 所有消息相关页面 (6/7页面)

#### 🎯 **核心功能**
- 智能时间格式化显示
- 支持相对时间和绝对时间
- 自动更新机制

#### 📋 **Props接口设计**
```typescript
interface TimeStampProps {
  // 时间配置
  timestamp: number
  format?: 'relative' | 'absolute' | 'smart'
  
  // 更新配置
  autoUpdate?: boolean
  updateInterval?: number
  
  // 样式配置
  style?: {
    fontSize?: number
    color?: string
    fontWeight?: string
  }
}
```

#### 🔄 **时间格式规则**
```typescript
const formatTime = (timestamp: number) => {
  const now = Date.now()
  const diff = now - timestamp
  
  if (diff < 60000) return '刚刚'
  if (diff < 3600000) return `${Math.floor(diff / 60000)}分钟前`
  if (diff < 86400000) return `${Math.floor(diff / 3600000)}小时前`
  if (diff < 604800000) return `${Math.floor(diff / 86400000)}天前`
  return new Date(timestamp).toLocaleDateString()
}
```

---

## 🔧 **中等复用组件设计 (60-80%复用率)**

### 🖼️ **8. ContentPreview - 内容预览组件**

**📍 复用页面**: 赞和收藏、评论页面 (2/7页面)

#### 🎯 **核心功能**
- 支持图片、视频、文字内容预览
- 统一的缩略图尺寸和样式
- 内容类型指示器

#### 📋 **Props接口设计**
```typescript
interface ContentPreviewProps {
  // 内容数据
  content: {
    type: 'image' | 'video' | 'text' | 'note'
    url?: string
    thumbnailUrl?: string
    title?: string
    description?: string
  }
  
  // 尺寸配置
  size: 'small' | 'medium' | 'large' // 32x32, 48x48, 64x64
  
  // 交互配置
  onPress?: () => void
  
  // 样式配置
  style?: {
    borderRadius?: number
    borderWidth?: number
    borderColor?: string
  }
}
```

---

### ⚠️ **9. ConfirmDialog - 确认对话框组件**

**📍 复用页面**: 所有需要确认的操作 (4/7页面)

#### 🎯 **核心功能**
- 模态对话框展示
- 支持自定义标题、内容、按钮
- 内置动画效果

#### 📋 **Props接口设计**
```typescript
interface ConfirmDialogProps {
  // 显示控制
  visible: boolean
  onClose: () => void
  
  // 内容配置
  icon?: ReactNode
  title: string
  message: string
  
  // 按钮配置
  buttons: {
    cancel?: {
      text: string
      onPress: () => void
    }
    confirm: {
      text: string
      onPress: () => void
      variant?: 'primary' | 'danger'
    }
  }
  
  // 样式配置
  style?: {
    width?: number
    backgroundColor?: string
  }
}
```

---

### 🔍 **10. SearchInput - 搜索输入框组件**

**📍 复用页面**: 私聊页面、分享笔记 (2/7页面)

#### 🎯 **核心功能**
- 统一的搜索输入界面
- 支持实时搜索和历史记录
- 内置清除和取消功能

#### 📋 **Props接口设计**
```typescript
interface SearchInputProps {
  // 输入配置
  placeholder: string
  value: string
  onChangeText: (text: string) => void
  
  // 搜索配置
  onSearch?: (query: string) => void
  onClear?: () => void
  debounceTime?: number
  
  // 历史记录
  history?: string[]
  onHistorySelect?: (item: string) => void
  
  // 样式配置
  style?: {
    height?: number
    borderRadius?: number
    backgroundColor?: string
  }
}
```

---

### 🔄 **11. PullRefresh - 下拉刷新组件**

**📍 复用页面**: 所有列表页面 (6/7页面)

#### 🎯 **核心功能**
- 下拉刷新功能封装
- 自定义刷新指示器
- 支持无限滚动加载

#### 📋 **Props接口设计**
```typescript
interface PullRefreshProps {
  // 子组件
  children: ReactNode
  
  // 刷新配置
  refreshing: boolean
  onRefresh: () => void
  
  // 加载更多配置
  hasMore?: boolean
  onLoadMore?: () => void
  loading?: boolean
  
  // 样式配置
  refreshColor?: string
  loadingText?: string
}
```

---

## 🎯 **专用组件设计 (单页面使用)**

### 🎴 **12. CategoryCard - 分类卡片组件**

**📍 复用页面**: 消息主页面 (1/7页面)

#### 🎯 **核心功能**
- 4宫格功能分类卡片展示
- 支持未读角标和点击动画
- 图标和文字的统一布局

#### 📋 **Props接口设计**
```typescript
interface CategoryCardProps {
  // 卡片数据
  cards: Array<{
    id: string
    icon: ReactNode
    title: string
    unreadCount?: number
    onPress: () => void
  }>
  
  // 布局配置
  columns: number // 默认2列
  spacing: number // 卡片间距
  
  // 样式配置
  cardStyle?: {
    width?: number
    height?: number
    borderRadius?: number
    backgroundColor?: string
  }
}
```

---

### 💬 **13. MessageBubble - 消息气泡组件**

**📍 复用页面**: 私聊对话页面 (1/7页面)

#### 🎯 **核心功能**
- 发送和接收消息的气泡样式
- 支持文字、图片、语音、视频消息
- 消息状态指示器

#### 📋 **Props接口设计**
```typescript
interface MessageBubbleProps {
  // 消息数据
  message: {
    id: string
    type: 'text' | 'image' | 'audio' | 'video'
    content: any
    timestamp: number
    senderId: string
  }
  
  // 显示配置
  isSelf: boolean // 是否为当前用户发送
  showAvatar?: boolean
  showTimestamp?: boolean
  
  // 状态配置
  status?: 'sending' | 'sent' | 'delivered' | 'read' | 'failed'
  
  // 交互配置
  onPress?: () => void
  onLongPress?: () => void
  onResend?: () => void // 失败消息重发
}
```

---

### 🟢 **14. StatusIndicator - 状态指示器组件**

**📍 复用页面**: 私聊对话页面 (1/7页面)

#### 🎯 **核心功能**
- 输入状态指示 ("正在输入...")
- 在线状态显示
- 消息发送状态

#### 📋 **Props接口设计**
```typescript
interface StatusIndicatorProps {
  // 状态类型
  type: 'typing' | 'online' | 'message'
  
  // 状态数据
  status: {
    typing?: {
      isTyping: boolean
      userName?: string
    }
    online?: 'online' | 'offline' | 'away'
    message?: 'sending' | 'sent' | 'delivered' | 'read' | 'failed'
  }
  
  // 样式配置
  style?: {
    position?: 'absolute' | 'relative'
    size?: number
    color?: string
  }
}
```

---

## ✨ **工具组件设计**

### 🎬 **15. AnimationWrapper - 动画包装组件**

**📍 复用页面**: 需要动画效果的所有组件

#### 🎯 **核心功能**
- 统一的动画效果封装
- 支持多种预设动画
- 手势动画集成

#### 📋 **Props接口设计**
```typescript
interface AnimationWrapperProps {
  // 子组件
  children: ReactNode
  
  // 动画类型
  type: 'fadeIn' | 'slideIn' | 'scale' | 'bounce' | 'custom'
  
  // 动画配置
  duration?: number
  delay?: number
  loop?: boolean
  
  // 触发配置
  trigger?: 'mount' | 'press' | 'scroll' | 'manual'
  
  // 自定义动画
  customAnimation?: {
    from: any
    to: any
    config?: any
  }
}
```

---

## 📊 **组件集成策略**

### 🔄 **数据流设计**

```typescript
// 全局状态管理 - 消息模块共享数据
interface MessageModuleState {
  // 用户信息
  currentUser: User
  onlineUsers: Record<string, OnlineStatus>
  
  // 消息数据
  conversations: Conversation[]
  unreadCounts: Record<string, number>
  
  // UI状态
  loading: Record<string, boolean>
  errors: Record<string, string>
}

// 组件间通信 - Props向下传递，Events向上冒泡
interface ComponentEventBus {
  // 用户交互事件
  onUserPress: (userId: string) => void
  onMessagePress: (messageId: string) => void
  
  // 导航事件
  onNavigateToChat: (conversationId: string) => void
  onNavigateBack: () => void
  
  // 状态更新事件
  onMarkAsRead: (messageId: string) => void
  onUpdateUnreadCount: (count: number) => void
}
```

### 🎨 **主题系统集成**

```typescript
// 统一的主题配置
interface MessageTheme {
  colors: {
    primary: string    // #8A2BE2
    secondary: string  // #999999
    background: string // #FFFFFF
    surface: string    // #F5F5F5
    error: string      // #FF3B30
    success: string    // #00C851
  }
  
  spacing: {
    xs: number  // 4px
    sm: number  // 8px
    md: number  // 16px
    lg: number  // 24px
    xl: number  // 32px
  }
  
  typography: {
    title: TextStyle      // 18sp bold
    subtitle: TextStyle   // 16sp regular
    body: TextStyle       // 14sp regular
    caption: TextStyle    // 12sp regular
  }
  
  animations: {
    quick: number   // 200ms
    normal: number  // 300ms
    slow: number    // 500ms
  }
}
```

---

## 🚀 **性能优化策略**

### ⚡ **组件层面优化**

1. **React.memo()** - 所有纯展示组件默认使用memo包装
2. **useMemo()** - 复杂计算和对象创建使用memo缓存
3. **useCallback()** - 事件处理函数使用callback缓存
4. **懒加载** - 大型组件支持动态导入

### 📋 **列表性能优化**

1. **FlatList虚拟化** - MessageListItem组件支持虚拟化渲染
2. **图片懒加载** - UserAvatar和ContentPreview支持懒加载
3. **增量加载** - 支持分页和无限滚动
4. **缓存策略** - 用户头像和内容预览图缓存

### 🔄 **状态管理优化**

1. **状态分割** - 按功能模块分割状态管理
2. **选择器优化** - 使用reselect避免不必要的重新渲染
3. **异步处理** - API调用使用async/await和错误边界

---

## 📋 **下一步实施计划**

### 🎯 **组件实施优先级**

1. **P0核心组件** (必须优先实施)
   - MessageListItem
   - UserAvatar  
   - NavigationBar
   - LoadingIndicator

2. **P1重要组件** (第二批实施)
   - ActionButton
   - EmptyState
   - TimeStamp
   - ConfirmDialog

3. **P2增强组件** (第三批实施)
   - ContentPreview
   - SearchInput
   - PullRefresh
   - AnimationWrapper

4. **P3专用组件** (最后实施)
   - CategoryCard
   - MessageBubble
   - StatusIndicator

### 📊 **质量保证检查项**

- ✅ **类型安全**: 所有Props都有完整的TypeScript类型定义
- ✅ **接口一致**: 相似功能的组件使用一致的Props命名
- ✅ **性能优化**: 所有组件都考虑了性能优化策略
- ✅ **可访问性**: 支持屏幕阅读器和键盘导航
- ✅ **测试覆盖**: 每个组件都有对应的单元测试

---

*本文档为消息模块共享组件库的完整设计规范，为后续的AI实施提供详细的指导标准。*
