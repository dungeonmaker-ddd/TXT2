# ğŸ¤– æ¶ˆæ¯æ¨¡å—AIå®æ–½æŒ‡å¯¼æ–‡æ¡£

> **å®Œæ•´çš„AIå®æ–½æ ‡å‡†å’Œè´¨é‡ä¿è¯ä½“ç³»**
> 
> ç‰ˆæœ¬ï¼šv1.0 | åˆ›å»ºæ—¶é—´ï¼š2025-09-29 | æŠ€æœ¯æ ˆï¼šExpo React Native + MyBatis-Plus
> è®¾è®¡æ ‡å‡†ï¼šUNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.4 + æ¶ˆæ¯æ¨¡å—ç»„ä»¶åŒ–æ¶æ„

---

## ğŸš¨ **å¼ºåˆ¶æ‰§è¡Œæ¡æ¬¾ (AIå¿…è¯»)**

### âš ï¸ **å‰åç«¯ä¸€ä½“åŒ–å¼ºåˆ¶è¦æ±‚**

**å½“AIæ¥æ”¶åˆ°æ¶ˆæ¯æ¨¡å—å®æ–½ä»»åŠ¡æ—¶ï¼Œå¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹è¦æ±‚æ‰§è¡Œï¼š**

- âœ… **åŒæ—¶åˆ›å»ºå‰ç«¯ç»„ä»¶å’Œåç«¯å®ç°çš„æ‰€æœ‰å¿…éœ€æ–‡ä»¶**
- âœ… **ç¡®ä¿åç«¯å®ç°å¯è¿è¡Œã€å¯æµ‹è¯•ï¼ŒåŒ…å«å®Œæ•´çš„entityã€dtoã€voã€controllerã€serviceã€serviceImplã€mapper**
- âœ… **æ•°æ®è®¿é—®å±‚å¼ºåˆ¶ä½¿ç”¨MyBatis-Plus + QueryWrapperæŠ€æœ¯æ ˆ**
- âœ… **æ¥å£è®¾è®¡ä¸¥æ ¼æŒ‰éœ€å®ç° - åªåˆ›å»ºå‰ç«¯å®é™…éœ€è¦çš„æ¥å£ï¼Œé¿å…è¿‡åº¦è®¾è®¡**
- âœ… **ä¸»æ–‡ä»¶å®Œæ•´åŒ–ç®¡ç† - å¼ºåˆ¶åœ¨ä¸»ç»„ä»¶æ–‡ä»¶å†…é›†ä¸­ç®¡ç†æ‰€æœ‰çŠ¶æ€ã€äº‹ä»¶å¤„ç†ã€æ•°æ®å¤„ç†ã€å·¥å…·å‡½æ•°ã€ä¸šåŠ¡é€»è¾‘**
- âŒ **ä¸¥ç¦ä»…åˆ›å»ºå‰ç«¯ç»„ä»¶è€Œå¿½ç•¥åç«¯å®ç°**
- âŒ **ä¸¥ç¦äº¤ä»˜ä¸å®Œæ•´çš„åç«¯äº¤äº’å±‚**
- âŒ **ä¸¥ç¦è¿‡åº¦è®¾è®¡æ¥å£å’Œè¿‡åº¦æ–‡ä»¶æ‹†åˆ†**

### ğŸ“‹ **è´¨é‡æ ‡å‡†æ£€æŸ¥æ¸…å•**

**æ¯æ¬¡å®æ–½å®Œæˆåï¼ŒAIå¿…é¡»è¿›è¡Œä»¥ä¸‹æ£€æŸ¥ï¼š**

#### ğŸ—ï¸ **æ¶æ„å®Œæ•´æ€§æ£€æŸ¥**
- [ ] ç›®å½•ç»“æ„å®Œå…¨ç¬¦åˆUNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.4æ ‡å‡†
- [ ] æ¶ˆæ¯æ¨¡å—ç›®å½•ç»“æ„ç¬¦åˆExpo React Nativeè§„èŒƒ
- [ ] 15ä¸ªå…±äº«ç»„ä»¶å…¨éƒ¨æŒ‰è®¾è®¡æ–‡æ¡£å®æ–½
- [ ] 7ä¸ªé¡µé¢ç»„ä»¶å…¨éƒ¨æŒ‰è®¾è®¡æ–‡æ¡£å®æ–½
- [ ] APIå±‚å’Œåç«¯äº¤äº’å±‚åŒæ—¶å®Œæ•´å®æ–½

#### ğŸ”§ **æŠ€æœ¯å®æ–½æ£€æŸ¥**
- [ ] æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨TypeScriptï¼Œç±»å‹å®šä¹‰å®Œæ•´
- [ ] åç«¯ä½¿ç”¨MyBatis-Plus + QueryWrapperæŠ€æœ¯æ ˆ
- [ ] Entityç±»æ­£ç¡®é…ç½®@TableNameã€@TableIdã€@TableFieldæ³¨è§£
- [ ] ServiceImplå±‚ä½¿ç”¨QueryWrapper/LambdaQueryWrapperæ‰§è¡ŒæŸ¥è¯¢
- [ ] å¤æ‚æŸ¥è¯¢ä½¿ç”¨QueryBuilderå°è£…
- [ ] Mapperæ¥å£ç»§æ‰¿BaseMapper<Entity>

#### ğŸ“¦ **ä¸»æ–‡ä»¶å®Œæ•´åŒ–æ£€æŸ¥**
- [ ] æ‰€æœ‰index.tsxæ–‡ä»¶éµå¾ªå…«æ®µå¼ç»“æ„
- [ ] æ‰€æœ‰çŠ¶æ€ç®¡ç†é›†ä¸­åœ¨ä¸»æ–‡ä»¶å†…ï¼Œæœªåˆ›å»ºç‹¬ç«‹hooksæ–‡ä»¶
- [ ] æ‰€æœ‰äº‹ä»¶å¤„ç†é›†ä¸­åœ¨ä¸»æ–‡ä»¶å†…ï¼Œæœªåˆ›å»ºç‹¬ç«‹äº‹ä»¶æ–‡ä»¶
- [ ] æ‰€æœ‰æ•°æ®å¤„ç†å’Œå·¥å…·å‡½æ•°é›†ä¸­åœ¨ä¸»æ–‡ä»¶å†…
- [ ] é¿å…äº†ä¸å¿…è¦çš„æ–‡ä»¶æ‹†åˆ†

#### ğŸŒ **æ¥å£è®¾è®¡æ£€æŸ¥**
- [ ] APIæ¥å£ä¸å‰ç«¯åŠŸèƒ½éœ€æ±‚ä¸€ä¸€å¯¹åº”
- [ ] æœªåˆ›å»ºå‰ç«¯ä¸éœ€è¦çš„æ‰¹é‡æ“ä½œæ¥å£
- [ ] æœªåˆ›å»ºç®¡ç†å‘˜åŠŸèƒ½æˆ–å¤æ‚æŠ¥è¡¨æ¥å£
- [ ] DTOåªåŒ…å«å‰ç«¯å®é™…ä½¿ç”¨çš„å­—æ®µ
- [ ] å‰åç«¯æ•°æ®ç±»å‹å®šä¹‰ä¸€è‡´

#### ğŸ¯ **ç»„ä»¶å¤ç”¨æ£€æŸ¥**
- [ ] MessageListItemç»„ä»¶åœ¨5ä¸ªé¡µé¢ä¸­æ­£ç¡®å¤ç”¨
- [ ] UserAvatarç»„ä»¶åœ¨æ‰€æœ‰é¡µé¢ä¸­æ­£ç¡®ä½¿ç”¨
- [ ] NavigationBarç»„ä»¶åœ¨6ä¸ªå­é¡µé¢ä¸­æ­£ç¡®ä½¿ç”¨
- [ ] è¾¾åˆ°90%+çš„ç»„ä»¶å¤ç”¨ç‡ç›®æ ‡

---

## ğŸ”§ **å®æ–½æµç¨‹ä¸æ­¥éª¤**

### ğŸ“Š **Phase 1: åŸºç¡€æ¶æ„å‡†å¤‡ (2-3å°æ—¶)**

#### ğŸ¯ **Step 1.1: åˆ›å»ºç›®å½•ç»“æ„**

```bash
# åˆ›å»ºæ¶ˆæ¯æ¨¡å—æ ¸å¿ƒç›®å½•
src/
â”œâ”€â”€ pages/Messages/
â”œâ”€â”€ shared/components/
â”œâ”€â”€ hooks/
â”œâ”€â”€ utils/
â”œâ”€â”€ constants/
â””â”€â”€ app/(tabs)/messages/
```

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- ä¸¥æ ¼æŒ‰ç…§è®¾è®¡æ–‡æ¡£ä¸­çš„ç›®å½•ç»“æ„åˆ›å»º
- ç¡®ä¿Expo Routeræ–‡ä»¶è·¯ç”±ç»“æ„æ­£ç¡®
- åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„README.mdæ–‡ä»¶

#### ğŸ¯ **Step 1.2: åˆ›å»ºæ ¸å¿ƒé…ç½®æ–‡ä»¶**

**ä¼˜å…ˆçº§é¡ºåºï¼š**
1. `src/pages/Messages/types.ts` - å…¨å±€ç±»å‹å®šä¹‰
2. `src/pages/Messages/constants.ts` - å…¨å±€å¸¸é‡é…ç½®
3. `src/constants/api.ts` - APIç«¯ç‚¹é…ç½®
4. `src/constants/colors.ts` - ä¸»é¢˜é¢œè‰²é…ç½®
5. `src/constants/sizes.ts` - å°ºå¯¸è§„æ ¼é…ç½®

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- ç±»å‹å®šä¹‰å¿…é¡»å®Œæ•´è¦†ç›–æ‰€æœ‰æ•°æ®ç»“æ„
- å¸¸é‡é…ç½®å¿…é¡»ä¸è®¾è®¡æ–‡æ¡£ä¸­çš„è§„æ ¼ä¸€è‡´
- æ”¯æŒä¸»é¢˜åˆ‡æ¢å’Œå¤šè¯­è¨€

#### ğŸ¯ **Step 1.3: åˆ›å»ºåç«¯äº¤äº’å±‚åŸºç¡€**

**åˆ›å»ºé¡ºåºï¼š**
1. Entityç±» - æ•°æ®åº“è¡¨æ˜ å°„
2. DTOç±» - å‰åç«¯æ•°æ®äº¤æ¢
3. VOç±» - æŸ¥è¯¢æ¡ä»¶å°è£…(å¯é€‰)
4. Mapperæ¥å£ - æ•°æ®è®¿é—®å±‚
5. Serviceæ¥å£ - ä¸šåŠ¡æœåŠ¡å®šä¹‰
6. ServiceImplç±» - ä¸šåŠ¡é€»è¾‘å®ç°
7. Controllerç±» - HTTPæ¥å£å±‚

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- Entityå¿…é¡»æ­£ç¡®é…ç½®MyBatis-Plusæ³¨è§£
- ServiceImplå¿…é¡»ä½¿ç”¨QueryWrapperæ‰§è¡ŒæŸ¥è¯¢
- Controllerå¿…é¡»ä¸å‰ç«¯APIæ¥å£å®Œå…¨å¯¹åº”

### ğŸ“Š **Phase 2: å…±äº«ç»„ä»¶å®æ–½ (4-5å°æ—¶)**

#### ğŸ¯ **Step 2.1: é«˜å¤ç”¨ç»„ä»¶ (P0ä¼˜å…ˆçº§)**

**å®æ–½é¡ºåºï¼š**
1. `MessageListItem` - æ ¸å¿ƒåˆ—è¡¨é¡¹ç»„ä»¶
2. `UserAvatar` - ç”¨æˆ·å¤´åƒç»„ä»¶
3. `NavigationBar` - å¯¼èˆªæ ç»„ä»¶
4. `LoadingIndicator` - åŠ è½½æŒ‡ç¤ºå™¨

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- æ¯ä¸ªç»„ä»¶çš„index.tsxå¿…é¡»ä½¿ç”¨å…«æ®µå¼ç»“æ„
- Propsæ¥å£å¿…é¡»ä¸è®¾è®¡æ–‡æ¡£å®Œå…¨ä¸€è‡´
- æ”¯æŒå¤šç§æ•°æ®ç±»å‹é€‚é…
- åŒ…å«å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰

#### ğŸ¯ **Step 2.2: ä¸­ç­‰å¤ç”¨ç»„ä»¶ (P1ä¼˜å…ˆçº§)**

**å®æ–½é¡ºåºï¼š**
1. `ActionButton` - æ“ä½œæŒ‰é’®ç»„ä»¶
2. `EmptyState` - ç©ºçŠ¶æ€ç»„ä»¶
3. `TimeStamp` - æ—¶é—´æˆ³ç»„ä»¶
4. `ConfirmDialog` - ç¡®è®¤å¯¹è¯æ¡†ç»„ä»¶

#### ğŸ¯ **Step 2.3: ä¸“ç”¨ç»„ä»¶ (P2ä¼˜å…ˆçº§)**

**å®æ–½é¡ºåºï¼š**
1. `CategoryCard` - åˆ†ç±»å¡ç‰‡ç»„ä»¶
2. `MessageBubble` - æ¶ˆæ¯æ°”æ³¡ç»„ä»¶
3. `StatusIndicator` - çŠ¶æ€æŒ‡ç¤ºå™¨ç»„ä»¶

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- ä¸“ç”¨ç»„ä»¶è™½ç„¶å¤ç”¨ç‡ä½ï¼Œä½†è®¾è®¡å¿…é¡»ç²¾è‰¯
- è€ƒè™‘æœªæ¥å¯èƒ½çš„æ‰©å±•å’Œå¤ç”¨åœºæ™¯
- ä¿æŒä¸å…¶ä»–ç»„ä»¶çš„é£æ ¼ä¸€è‡´æ€§

### ğŸ“Š **Phase 3: é¡µé¢ç»„ä»¶å®æ–½ (6-8å°æ—¶)**

#### ğŸ¯ **Step 3.1: æ ¸å¿ƒé¡µé¢ (P0ä¼˜å…ˆçº§)**

**å®æ–½é¡ºåºï¼š**
1. **æ¶ˆæ¯ä¸»é¡µé¢** - æ¨¡å—å…¥å£ï¼Œæœ€é‡è¦
2. **ç§èŠå¯¹è¯é¡µé¢** - æ ¸å¿ƒåŠŸèƒ½ï¼Œäº¤äº’å¤æ‚

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- ä¸»é¡µé¢å¿…é¡»æ­£ç¡®é›†æˆæ‰€æœ‰åŒºåŸŸç»„ä»¶
- å¯¹è¯é¡µé¢å¿…é¡»æ”¯æŒå®æ—¶é€šä¿¡
- WebSocketè¿æ¥å¿…é¡»ç¨³å®šå¯é 

#### ğŸ¯ **Step 3.2: åˆ—è¡¨é¡µé¢ (P1ä¼˜å…ˆçº§)**

**å®æ–½é¡ºåºï¼š**
1. **èµå’Œæ”¶è—é¡µé¢** - ç”¨æˆ·å…³æ³¨åº¦é«˜
2. **è¯„è®ºé¡µé¢** - ç¤¾äº¤äº’åŠ¨æ ¸å¿ƒ
3. **ç³»ç»Ÿé€šçŸ¥é¡µé¢** - é‡è¦ä¿¡æ¯ä¼ è¾¾

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- æ‰€æœ‰åˆ—è¡¨é¡µé¢å¿…é¡»ä½¿ç”¨ç›¸åŒçš„å¸ƒå±€ç»“æ„
- æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œæ— é™æ»šåŠ¨
- æ­£ç¡®å¤„ç†ç©ºçŠ¶æ€å’ŒåŠ è½½çŠ¶æ€

#### ğŸ¯ **Step 3.3: è¾…åŠ©é¡µé¢ (P2ä¼˜å…ˆçº§)**

**å®æ–½é¡ºåºï¼š**
1. **ç²‰ä¸é¡µé¢** - ç¤¾äº¤å…³ç³»ç®¡ç†
2. **ç¡®è®¤å¯¹è¯æ¡†é¡µé¢** - å…¨å±€å¼¹çª—

### ğŸ“Š **Phase 4: APIå±‚ä¸åç«¯é›†æˆ (3-4å°æ—¶)**

#### ğŸ¯ **Step 4.1: APIæ¥å£å±‚å®æ–½**

**åˆ›å»ºé¡ºåºï¼š**
1. `apiMessagesMain.ts` - ä¸»é¡µé¢API
2. `apiMessagesChat.ts` - ç§èŠAPI
3. `apiMessagesLikes.ts` - èµå’Œæ”¶è—API
4. `apiMessagesComments.ts` - è¯„è®ºAPI
5. `apiMessagesFollowers.ts` - ç²‰ä¸API
6. `apiMessagesNotifications.ts` - ç³»ç»Ÿé€šçŸ¥API
7. `apiMessagesAggregate.ts` - èšåˆAPI

**AIæ‰§è¡Œè¦æ±‚ï¼š**
- æ¯ä¸ªAPIæ–‡ä»¶åªåŒ…å«å¯¹åº”é¡µé¢å®é™…éœ€è¦çš„æ¥å£
- æ¥å£å‘½åå¿…é¡»ä¸åç«¯Controlleræ–¹æ³•å¯¹åº”
- é”™è¯¯å¤„ç†å¿…é¡»ç»Ÿä¸€å’Œå®Œæ•´
- æ”¯æŒè¯·æ±‚é‡è¯•å’Œç¼“å­˜æœºåˆ¶

#### ğŸ¯ **Step 4.2: åç«¯å®æ–½å®Œæ•´æ€§æ£€æŸ¥**

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æ‰€æœ‰Entityç±»å·²åˆ›å»ºå¹¶æ­£ç¡®é…ç½®æ³¨è§£
- [ ] æ‰€æœ‰DTOç±»å­—æ®µä¸å‰ç«¯APIä¸€è‡´
- [ ] æ‰€æœ‰Serviceæ–¹æ³•ä½¿ç”¨QueryWrapperæŸ¥è¯¢
- [ ] æ‰€æœ‰Controlleræ¥å£ä¸å‰ç«¯APIå¯¹åº”
- [ ] å¤æ‚æŸ¥è¯¢ä½¿ç”¨QueryBuilderå°è£…
- [ ] æ•°æ®åº“è¿æ¥å’Œé…ç½®æ­£ç¡®

### ğŸ“Š **Phase 5: æµ‹è¯•ä¸ä¼˜åŒ– (2-3å°æ—¶)**

#### ğŸ¯ **Step 5.1: å•å…ƒæµ‹è¯•å®æ–½**

**æµ‹è¯•è¦†ç›–è¦æ±‚ï¼š**
- æ‰€æœ‰å…±äº«ç»„ä»¶å¿…é¡»æœ‰å¯¹åº”æµ‹è¯•æ–‡ä»¶
- æ‰€æœ‰APIæ¥å£å¿…é¡»æœ‰é›†æˆæµ‹è¯•
- å…³é”®ä¸šåŠ¡é€»è¾‘å¿…é¡»æœ‰å•å…ƒæµ‹è¯•
- é”™è¯¯å¤„ç†åœºæ™¯å¿…é¡»æœ‰æµ‹è¯•è¦†ç›–

#### ğŸ¯ **Step 5.2: æ€§èƒ½ä¼˜åŒ–æ£€æŸ¥**

**ä¼˜åŒ–æ£€æŸ¥é¡¹ï¼š**
- [ ] é•¿åˆ—è¡¨ä½¿ç”¨FlatListè™šæ‹ŸåŒ–æ¸²æŸ“
- [ ] å›¾ç‰‡ç»„ä»¶æ”¯æŒæ‡’åŠ è½½å’Œç¼“å­˜
- [ ] ç»„ä»¶ä½¿ç”¨React.memoé˜²æ­¢ä¸å¿…è¦æ¸²æŸ“
- [ ] äº‹ä»¶å¤„ç†å‡½æ•°ä½¿ç”¨useCallbackä¼˜åŒ–
- [ ] å¤æ‚è®¡ç®—ä½¿ç”¨useMemoç¼“å­˜

---

## ğŸ“‹ **ä»£ç å®æ–½è§„èŒƒ**

### ğŸ¯ **å…«æ®µå¼ä»£ç ç»“æ„å¼ºåˆ¶è¦æ±‚**

**æ‰€æœ‰ä¸»æ–‡ä»¶(index.tsx)å¿…é¡»ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ç»“æ„ï¼š**

```typescript
// #region 1. File Banner & TOC
/**
 * ç»„ä»¶åç§° - åŠŸèƒ½æè¿°
 * 
 * TOC (å¿«é€Ÿè·³è½¬):
 * [1] Imports
 * [2] Types & Schema  
 * [3] Constants & Config
 * [4] Utils & Helpers
 * [5] State Management
 * [6] Domain Logic
 * [7] UI Components & Rendering
 * [8] Exports
 */
// #endregion

// #region 2. Imports
// React/React Nativeæ ¸å¿ƒå¯¼å…¥
import React, { useState, useEffect, useCallback, useMemo } from 'react'
import { View, Text, FlatList, StyleSheet } from 'react-native'

// Expoç›¸å…³å¯¼å…¥
import { router } from 'expo-router'

// ç¬¬ä¸‰æ–¹åº“å¯¼å…¥
import { useQuery } from '@tanstack/react-query'

// å†…éƒ¨æ¨¡å—å¯¼å…¥ (types, constants, shared components)
import { MessageListItemProps, ConversationData } from './types'
import { MESSAGE_CONSTANTS } from './constants'
import { MessageListItem, UserAvatar, LoadingIndicator } from '../../../shared/components'
// #endregion

// #region 3. Types & Schema
// æœ¬åœ°ç±»å‹å®šä¹‰ (å¦‚æœtypes.tsä¸å¤Ÿç”¨)
interface LocalState {
  refreshing: boolean
  hasMore: boolean
}

// Propsæ¥å£å®šä¹‰
interface MessagesMainPageProps {
  // ... å…·ä½“Propså®šä¹‰
}
// #endregion

// #region 4. Constants & Config
// æœ¬åœ°å¸¸é‡ (å¦‚æœconstants.tsä¸å¤Ÿç”¨)
const LOCAL_CONSTANTS = {
  REFRESH_THRESHOLD: 100,
  LOAD_MORE_THRESHOLD: 10
} as const

// é…ç½®é¡¹
const PAGE_CONFIG = {
  pageSize: 20,
  initialLoadSize: 10
} as const
// #endregion

// #region 5. Utils & Helpers
// ğŸ¯ æœ¬åœ°å·¥å…·å‡½æ•° - é›†ä¸­ç®¡ç†ï¼Œé¿å…åˆ›å»ºç‹¬ç«‹æ–‡ä»¶
const formatMessageTime = useCallback((timestamp: number): string => {
  const now = Date.now()
  const diff = now - timestamp
  
  if (diff < 60000) return 'åˆšåˆš'
  if (diff < 3600000) return `${Math.floor(diff / 60000)}åˆ†é’Ÿå‰`
  return new Date(timestamp).toLocaleDateString()
}, [])

const processMessageData = useCallback((rawData: any[]) => {
  return rawData.map(item => ({
    ...item,
    formattedTime: formatMessageTime(item.timestamp),
    isUnread: !item.readAt
  }))
}, [formatMessageTime])

// æ•°æ®éªŒè¯å‡½æ•°
const validateMessageData = useCallback((data: any): data is ConversationData => {
  return data && 
         typeof data.id === 'string' && 
         typeof data.userId === 'string' &&
         typeof data.lastMessage === 'object'
}, [])
// #endregion

// #region 6. State Management
// ğŸ¯ çŠ¶æ€åˆå§‹åŒ– - é›†ä¸­ç®¡ç†ï¼Œé¿å…åˆ›å»ºç‹¬ç«‹hooksæ–‡ä»¶
const MessagesMainPage: React.FC<MessagesMainPageProps> = ({ navigation, initialData }) => {
  // åŸºç¡€çŠ¶æ€
  const [refreshing, setRefreshing] = useState(false)
  const [hasMore, setHasMore] = useState(true)
  const [selectedItems, setSelectedItems] = useState<string[]>([])
  
  // æ•°æ®çŠ¶æ€ - ä½¿ç”¨react-queryç®¡ç†
  const { 
    data: conversations, 
    isLoading, 
    error, 
    refetch 
  } = useQuery({
    queryKey: ['conversations'],
    queryFn: fetchConversations,
    initialData: initialData?.conversations
  })
  
  const { 
    data: unreadCounts 
  } = useQuery({
    queryKey: ['unreadCounts'],
    queryFn: fetchUnreadCounts
  })
  
  // æ´¾ç”ŸçŠ¶æ€
  const processedConversations = useMemo(() => {
    if (!conversations) return []
    return processMessageData(conversations)
  }, [conversations, processMessageData])
  
  // å‰¯ä½œç”¨ç®¡ç†
  useEffect(() => {
    // å®æ—¶æ¶ˆæ¯ç›‘å¬
    const unsubscribe = subscribeToRealtimeMessages((newMessage) => {
      // å¤„ç†æ–°æ¶ˆæ¯
      handleNewMessage(newMessage)
    })
    
    return unsubscribe
  }, [])
// #endregion

// #region 7. Domain Logic
// ğŸ¯ äº‹ä»¶å¤„ç†å‡½æ•° - é›†ä¸­ç®¡ç†ï¼Œé¿å…åˆ›å»ºç‹¬ç«‹äº‹ä»¶æ–‡ä»¶
const handleCategoryPress = useCallback((categoryId: string) => {
  switch (categoryId) {
    case 'likes':
      router.push('/messages/likes')
      break
    case 'comments':
      router.push('/messages/comments')
      break
    case 'followers':
      router.push('/messages/followers')
      break
    case 'notifications':
      router.push('/messages/notifications')
      break
  }
}, [])

const handleConversationPress = useCallback((conversationId: string) => {
  router.push(`/messages/chat/${conversationId}`)
}, [])

const handleRefresh = useCallback(async () => {
  setRefreshing(true)
  try {
    await refetch()
  } finally {
    setRefreshing(false)
  }
}, [refetch])

const handleLoadMore = useCallback(() => {
  if (hasMore && !isLoading) {
    // åŠ è½½æ›´å¤šæ•°æ®
    loadMoreConversations()
  }
}, [hasMore, isLoading])

// ä¸šåŠ¡é€»è¾‘å‡½æ•°
const handleNewMessage = useCallback((message: Message) => {
  // æ›´æ–°å¯¹è¯åˆ—è¡¨
  // æ›´æ–°æœªè¯»è®¡æ•°
  // è§¦å‘é‡æ–°æ¸²æŸ“
}, [])
// #endregion

// #region 8. UI Components & Rendering
// å­ç»„ä»¶å®šä¹‰
const MessageCategoryArea = useMemo(() => (
  <View style={styles.categoryArea}>
    {MESSAGE_CATEGORIES.map(category => (
      <CategoryCard
        key={category.id}
        {...category}
        unreadCount={unreadCounts?.[category.id] || 0}
        onPress={() => handleCategoryPress(category.id)}
      />
    ))}
  </View>
), [unreadCounts, handleCategoryPress])

const ConversationListArea = useMemo(() => (
  <FlatList
    data={processedConversations}
    renderItem={({ item }) => (
      <MessageListItem
        key={item.id}
        type="conversation"
        user={item.user}
        content={item.lastMessage}
        status={{
          isRead: item.isRead,
          timestamp: item.timestamp,
          unreadCount: item.unreadCount
        }}
        interactions={{
          onPress: () => handleConversationPress(item.id)
        }}
        display={{
          showUnreadBadge: true,
          showTimestamp: true
        }}
      />
    )}
    refreshing={refreshing}
    onRefresh={handleRefresh}
    onEndReached={handleLoadMore}
    onEndReachedThreshold={0.1}
    ListEmptyComponent={
      <EmptyState 
        title="æš‚æ— æ¶ˆæ¯"
        description="å¿«å»å’Œæœ‹å‹å¼€å§‹èŠå¤©å§"
      />
    }
    style={styles.conversationList}
  />
), [processedConversations, refreshing, handleRefresh, handleLoadMore, handleConversationPress])

// ä¸»æ¸²æŸ“JSX
return (
  <View style={styles.container}>
    <NavigationArea 
      title="æ¶ˆæ¯"
      showSettings={true}
      onSettingsPress={() => router.push('/messages/settings')}
    />
    
    {MessageCategoryArea}
    
    {isLoading && <LoadingIndicator />}
    {error && <ErrorState error={error} onRetry={refetch} />}
    
    {ConversationListArea}
  </View>
)
} // ç»„ä»¶ç»“æŸ

// æ ·å¼å®šä¹‰
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#FFFFFF'
  },
  categoryArea: {
    padding: 16,
    backgroundColor: '#FFFFFF'
  },
  conversationList: {
    flex: 1
  }
})
// #endregion

// #region 9. Exports
export default MessagesMainPage

// å¯é€‰å¯¼å‡º
export type { MessagesMainPageProps }
export { MESSAGE_CONSTANTS }
// #endregion
```

### ğŸ”§ **MyBatis-Plusåç«¯å®æ–½è§„èŒƒ**

#### ğŸ¯ **Entityç±»æ ‡å‡†æ¨¡æ¿**

```java
@TableName("messages")
@Data
@EqualsAndHashCode(callSuper = false)
public class EntityMessages implements Serializable {
    
    @TableId(value = "id", type = IdType.ASSIGN_UUID)
    private String id;
    
    @TableField("conversation_id")
    private String conversationId;
    
    @TableField("sender_id")
    private String senderId;
    
    @TableField("content")
    private String content;
    
    @TableField("message_type")
    private String messageType;
    
    @TableField(value = "created_at", fill = FieldFill.INSERT)
    private LocalDateTime createdAt;
    
    @TableField(value = "updated_at", fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updatedAt;
    
    @TableLogic
    @TableField("deleted")
    private Boolean deleted;
}
```

#### ğŸ¯ **ServiceImplç±»æ ‡å‡†æ¨¡æ¿**

```java
@Service
public class ServiceImplMessages implements ServiceMessages {
    
    @Autowired
    private MapperMessages messagesMapper;
    
    @Override
    public List<DtoMessagesMain> getConversations(String userId, int page, int size) {
        // ä½¿ç”¨QueryWrapperæ„å»ºæŸ¥è¯¢æ¡ä»¶
        LambdaQueryWrapper<EntityMessages> queryWrapper = new LambdaQueryWrapper<>();
        queryWrapper.eq(EntityMessages::getSenderId, userId)
                   .or()
                   .eq(EntityMessages::getReceiverId, userId)
                   .orderByDesc(EntityMessages::getCreatedAt)
                   .last("LIMIT " + (page * size) + ", " + size);
        
        List<EntityMessages> messages = messagesMapper.selectList(queryWrapper);
        
        // è½¬æ¢ä¸ºDTO
        return messages.stream()
                      .map(this::convertToDto)
                      .collect(Collectors.toList());
    }
    
    @Override
    public DtoMessagesChat sendMessage(String conversationId, DtoMessagesSend messageDto) {
        // ä¸šåŠ¡é€»è¾‘å¤„ç†
        EntityMessages message = convertFromDto(messageDto);
        message.setConversationId(conversationId);
        message.setCreatedAt(LocalDateTime.now());
        
        // ä¿å­˜æ¶ˆæ¯
        messagesMapper.insert(message);
        
        // æ›´æ–°å¯¹è¯æœ€åæ¶ˆæ¯æ—¶é—´
        updateConversationLastMessage(conversationId, message);
        
        return convertToChatDto(message);
    }
    
    // å¤æ‚æŸ¥è¯¢ä½¿ç”¨QueryBuilder
    @Override
    public List<DtoMessagesLikes> getLikeMessages(String userId, QueryMessagesBuilder queryBuilder) {
        QueryWrapper<EntityMessages> wrapper = queryBuilder
            .userId(userId)
            .messageType("like")
            .orderByCreatedAtDesc()
            .build();
            
        return messagesMapper.selectList(wrapper)
                            .stream()
                            .map(this::convertToLikesDto)
                            .collect(Collectors.toList());
    }
}
```

---

## ğŸ” **å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ**

### âŒ **å¸¸è§é”™è¯¯ä¸é¿å…æ–¹æ³•**

#### ğŸš« **é”™è¯¯1: è¿‡åº¦æ–‡ä»¶æ‹†åˆ†**
```
âŒ é”™è¯¯åšæ³•:
src/pages/Messages/MainPage/
â”œâ”€â”€ hooks/useMessageData.ts        # ç¦æ­¢åˆ›å»º
â”œâ”€â”€ hooks/useConversationList.ts   # ç¦æ­¢åˆ›å»º
â”œâ”€â”€ utils/messageHelpers.ts        # ç¦æ­¢åˆ›å»º
â”œâ”€â”€ handlers/eventHandlers.ts      # ç¦æ­¢åˆ›å»º

âœ… æ­£ç¡®åšæ³•:
src/pages/Messages/MainPage/
â”œâ”€â”€ index.tsx                      # æ‰€æœ‰é€»è¾‘é›†ä¸­åœ¨ä¸»æ–‡ä»¶
â”œâ”€â”€ types.ts                       # åªåŒ…å«ç±»å‹å®šä¹‰
â”œâ”€â”€ constants.ts                   # åªåŒ…å«å¸¸é‡é…ç½®
```

#### ğŸš« **é”™è¯¯2: æ¥å£è¿‡åº¦è®¾è®¡**
```
âŒ ç¦æ­¢åˆ›å»ºçš„æ¥å£:
- POST /messages/batch-delete      # å‰ç«¯æ²¡æœ‰æ‰¹é‡åˆ é™¤éœ€æ±‚
- GET /messages/admin/statistics   # ä¸æ˜¯ç®¡ç†å‘˜åŠŸèƒ½
- POST /messages/export-csv        # å‰ç«¯æ²¡æœ‰å¯¼å‡ºéœ€æ±‚

âœ… åªåˆ›å»ºå‰ç«¯éœ€è¦çš„æ¥å£:
- GET /messages/conversations      # è·å–å¯¹è¯åˆ—è¡¨ âœ…
- POST /messages/send              # å‘é€æ¶ˆæ¯ âœ…
- PUT /messages/mark-read          # æ ‡è®°å·²è¯» âœ…
```

#### ğŸš« **é”™è¯¯3: åç«¯æŠ€æœ¯æ ˆé”™è¯¯**
```
âŒ é”™è¯¯åšæ³•:
@Query("SELECT * FROM messages WHERE user_id = ?1")
List<Messages> findByUserId(String userId);  # ç¦æ­¢ä½¿ç”¨JPA

âœ… æ­£ç¡®åšæ³•:
LambdaQueryWrapper<EntityMessages> wrapper = new LambdaQueryWrapper<>();
wrapper.eq(EntityMessages::getUserId, userId);
List<EntityMessages> messages = messagesMapper.selectList(wrapper);
```

### âœ… **æœ€ä½³å®è·µç¤ºä¾‹**

#### ğŸ¯ **æœ€ä½³å®è·µ1: ç»„ä»¶å¤ç”¨è®¾è®¡**
```typescript
// MessageListItemç»„ä»¶æ”¯æŒå¤šç§æ•°æ®ç±»å‹
const MessageListItem: React.FC<MessageListItemProps> = ({ type, ...props }) => {
  const config = useMemo(() => {
    switch (type) {
      case 'conversation':
        return { showUnreadBadge: true, showTimestamp: true }
      case 'like':
        return { showActionIcon: true, showContentPreview: true }
      case 'comment':
        return { showActionIcon: true, showContentPreview: true }
      // ... å…¶ä»–ç±»å‹
    }
  }, [type])
  
  return (
    <View style={styles.container}>
      {/* ç»Ÿä¸€çš„UIç»“æ„ï¼Œæ ¹æ®typeè°ƒæ•´æ˜¾ç¤º */}
    </View>
  )
}
```

#### ğŸ¯ **æœ€ä½³å®è·µ2: APIä¸ä¸šåŠ¡é€»è¾‘å¯¹åº”**
```typescript
// å‰ç«¯APIè°ƒç”¨
const useConversations = () => {
  return useQuery({
    queryKey: ['conversations'],
    queryFn: () => apiMessagesMain.getConversations({
      page: 0,
      size: 20
    })
  })
}

// å¯¹åº”çš„åç«¯Serviceæ–¹æ³•
@Service
public class ServiceImplMessages {
  public List<DtoMessagesMain> getConversations(int page, int size) {
    // åªå®ç°å‰ç«¯å®é™…éœ€è¦çš„é€»è¾‘
    // ä¸æ·»åŠ å‰ç«¯ç”¨ä¸åˆ°çš„å¤æ‚åŠŸèƒ½
  }
}
```

---

## ğŸ“Š **äº¤ä»˜è´¨é‡æ£€æŸ¥æ¸…å•**

### ğŸ” **æœ€ç»ˆäº¤ä»˜æ£€æŸ¥ (AIå¿…é¡»å®Œæˆ)**

#### âœ… **æ–‡ä»¶å®Œæ•´æ€§æ£€æŸ¥**
- [ ] 15ä¸ªå…±äº«ç»„ä»¶å…¨éƒ¨åˆ›å»ºå®Œæˆ
- [ ] 7ä¸ªé¡µé¢ç»„ä»¶å…¨éƒ¨åˆ›å»ºå®Œæˆ
- [ ] 7ä¸ªAPIæ–‡ä»¶å…¨éƒ¨åˆ›å»ºå®Œæˆ
- [ ] åç«¯8ä¸ªæ ¸å¿ƒæ–‡ä»¶(entityã€dtoã€voã€controllerã€serviceã€serviceImplã€mapperã€queryBuilder)å…¨éƒ¨åˆ›å»ºå®Œæˆ
- [ ] æ‰€æœ‰README.mdæ–‡æ¡£å®Œæ•´

#### âœ… **ä»£ç è´¨é‡æ£€æŸ¥**
- [ ] æ‰€æœ‰index.tsxæ–‡ä»¶ä½¿ç”¨å…«æ®µå¼ç»“æ„
- [ ] æ‰€æœ‰TypeScriptç±»å‹å®šä¹‰å®Œæ•´
- [ ] æ‰€æœ‰ç»„ä»¶Propsæ¥å£ä¸è®¾è®¡æ–‡æ¡£ä¸€è‡´
- [ ] æ— TypeScriptç¼–è¯‘é”™è¯¯
- [ ] æ— ESLintè­¦å‘Šé”™è¯¯

#### âœ… **æ¶æ„è§„èŒƒæ£€æŸ¥**
- [ ] ç›®å½•ç»“æ„å®Œå…¨ç¬¦åˆUNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.4
- [ ] ä¸»æ–‡ä»¶å®Œæ•´åŒ–ç¨‹åº¦è¾¾æ ‡(æ²¡æœ‰ä¸å¿…è¦çš„æ–‡ä»¶æ‹†åˆ†)
- [ ] ç»„ä»¶å¤ç”¨ç‡è¾¾åˆ°90%+ç›®æ ‡
- [ ] å‰åç«¯ä¸€ä½“åŒ–å®Œæ•´å®æ–½

#### âœ… **åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥**
- [ ] æ‰€æœ‰é¡µé¢é—´å¯¼èˆªæµç¨‹æ­£ç¡®
- [ ] WebSocketå®æ—¶é€šä¿¡åŠŸèƒ½å®Œæ•´
- [ ] å›¾ç‰‡ä¸Šä¼ å’Œå¤„ç†åŠŸèƒ½å®Œæ•´
- [ ] é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆå®Œæ•´
- [ ] æ€§èƒ½ä¼˜åŒ–æªæ–½å…¨éƒ¨å®æ–½

#### âœ… **æµ‹è¯•è¦†ç›–æ£€æŸ¥**
- [ ] å…³é”®ç»„ä»¶æœ‰å•å…ƒæµ‹è¯•
- [ ] APIæ¥å£æœ‰é›†æˆæµ‹è¯•
- [ ] é”™è¯¯å¤„ç†æœ‰æµ‹è¯•è¦†ç›–
- [ ] æ€§èƒ½ä¼˜åŒ–æœ‰æµ‹è¯•éªŒè¯

### ğŸš€ **äº¤ä»˜æ ‡å‡†**

**AIå¿…é¡»ç¡®ä¿äº¤ä»˜çš„ç³»ç»Ÿæ»¡è¶³ä»¥ä¸‹æ ‡å‡†ï¼š**

1. **ç«‹å³å¯ç”¨**: ä»£ç å¯ä»¥ç›´æ¥è¿è¡Œï¼Œæ— éœ€é¢å¤–ä¿®æ”¹
2. **åŠŸèƒ½å®Œæ•´**: æ‰€æœ‰è®¾è®¡æ–‡æ¡£ä¸­çš„åŠŸèƒ½éƒ½å·²å®ç°
3. **è´¨é‡è¾¾æ ‡**: é€šè¿‡æ‰€æœ‰è´¨é‡æ£€æŸ¥æ¸…å•
4. **æ–‡æ¡£é½å…¨**: æ¯ä¸ªç»„ä»¶å’Œé¡µé¢éƒ½æœ‰å®Œæ•´æ–‡æ¡£
5. **å¯ç»´æŠ¤æ€§**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

---

## ğŸ†˜ **æ•…éšœæ’é™¤ä¸æ”¯æŒ**

### ğŸ”§ **å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ**

#### â“ **é—®é¢˜1: Expo Routerå¯¼èˆªä¸å·¥ä½œ**
```
è§£å†³æ–¹æ¡ˆ:
1. æ£€æŸ¥appç›®å½•ç»“æ„æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤_layout.tsxæ–‡ä»¶é…ç½®
3. éªŒè¯è·¯ç”±å‚æ•°ä¼ é€’æ ¼å¼
4. æ£€æŸ¥å¯¼èˆªé’©å­çš„æ­£ç¡®ä½¿ç”¨
```

#### â“ **é—®é¢˜2: MyBatis-PlusæŸ¥è¯¢å¤±è´¥**
```
è§£å†³æ–¹æ¡ˆ:
1. æ£€æŸ¥Entityç±»æ³¨è§£é…ç½®
2. ç¡®è®¤æ•°æ®åº“è¡¨åå’Œå­—æ®µåæ˜ å°„
3. éªŒè¯QueryWrapperè¯­æ³•
4. æ£€æŸ¥Mapperæ¥å£ç»§æ‰¿å…³ç³»
```

#### â“ **é—®é¢˜3: ç»„ä»¶Propsç±»å‹é”™è¯¯**
```
è§£å†³æ–¹æ¡ˆ:
1. å¯¹ç…§è®¾è®¡æ–‡æ¡£æ£€æŸ¥Propsæ¥å£å®šä¹‰
2. ç¡®è®¤TypeScriptç‰ˆæœ¬å…¼å®¹æ€§
3. éªŒè¯å¯¼å…¥è·¯å¾„çš„æ­£ç¡®æ€§
4. æ£€æŸ¥æ³›å‹ç±»å‹å‚æ•°
```

### ğŸ“ **æ”¯æŒæ¸ é“**

- **æŠ€æœ¯æ–‡æ¡£**: å‚è€ƒUNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.4
- **è®¾è®¡è§„èŒƒ**: å‚è€ƒæ¶ˆæ¯æ¨¡å—ç»„ä»¶åŒ–æ¶æ„è®¾è®¡æ–‡æ¡£
- **ä»£ç ç¤ºä¾‹**: å‚è€ƒæœ¬æ–‡æ¡£ä¸­çš„æœ€ä½³å®è·µéƒ¨åˆ†

---

## ğŸ“ˆ **æŒç»­æ”¹è¿›ä¸å‡çº§**

### ğŸ”„ **ç‰ˆæœ¬ç®¡ç†**

- **å½“å‰ç‰ˆæœ¬**: v1.0
- **ä¸‹ä¸ªç‰ˆæœ¬**: v1.1 (è®¡åˆ’å¢åŠ è¯­éŸ³æ¶ˆæ¯åŠŸèƒ½)
- **å‡çº§ç­–ç•¥**: å‘åå…¼å®¹ï¼Œæ¸è¿›å¼å¢å¼º

### ğŸ“Š **æ€§èƒ½ç›‘æ§**

- **ç»„ä»¶æ¸²æŸ“æ€§èƒ½**: ä½¿ç”¨React DevTools Profilerç›‘æ§
- **APIå“åº”æ—¶é—´**: è®¾ç½®æ€§èƒ½é˜ˆå€¼å’Œç›‘æ§
- **å†…å­˜ä½¿ç”¨**: å®šæœŸæ£€æŸ¥å†…å­˜æ³„æ¼
- **ç”¨æˆ·ä½“éªŒ**: æ”¶é›†ç”¨æˆ·åé¦ˆå’Œä½¿ç”¨æ•°æ®

---

**AIå®æ–½å®Œæˆåï¼Œå¿…é¡»ç”Ÿæˆå®æ–½æŠ¥å‘Šï¼ŒåŒ…å«ï¼š**
- âœ… å·²å®Œæˆçš„åŠŸèƒ½æ¸…å•
- âš ï¸ å‘ç°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
- ğŸ“Š è´¨é‡æ£€æŸ¥ç»“æœ
- ğŸš€ æ€§èƒ½æµ‹è¯•ç»“æœ
- ğŸ“‹ å»ºè®®çš„åç»­ä¼˜åŒ–æ–¹å‘

*æœ¬æ–‡æ¡£ä¸ºæ¶ˆæ¯æ¨¡å—çš„å®Œæ•´AIå®æ–½æŒ‡å¯¼æ ‡å‡†ï¼Œç¡®ä¿ç³»ç»Ÿå®æ–½çš„è´¨é‡å’Œä¸€è‡´æ€§ã€‚*
