# 📐 第1层 - 首页模块宏观架构设计文档 v1.0

> **React Native + Zustand 技术栈下的首页模块整体规划方案**

---

## 📋 **文档信息**

| 项目信息 | 详细内容 |
|---------|---------|
| **文档层级** | 第1层 - 宏观架构设计 |
| **设计版本** | v1.0 |
| **技术栈** | React Native + Zustand |
| **创建时间** | 2025年9月 |
| **设计目标** | 整体架构规划 + 文件夹结构设计 |
| **审核阶段** | 等待审核和修改优化 |

---

## 🎯 **宏观设计原则**

### 📐 **分层架构原则**
- **第1层**：宏观架构设计 - 整体规划和文件夹结构 ⭐ **当前层级**
- **第2层**：模块详细设计 - 具体页面和组件设计
- **第3层**：组件实现设计 - 组件内部逻辑和接口
- **第4层**：代码实施设计 - 具体代码实现指导

### 🏗️ **技术栈约束**
- **开发平台**：Expo (React Native开发平台)
- **前端框架**：React Native (跨平台移动端开发)
- **状态管理**：Zustand (轻量级状态管理库)
- **导航系统**：Expo Router (基于文件系统的路由)
- **UI组件库**：基于后端配置的自定义组件系统
- **数据获取**：基于fetch/axios的API调用层
- **构建工具**：Expo CLI / EAS Build

---

## 📂 **整体文件夹架构规划 (Expo 结构)**

### 🏗️ **Expo项目根目录结构**

```
项目根目录/
├── app/                                      # 📱 Expo Router路由目录 (新增)
│   ├── (tabs)/                               # Tab导航组
│   │   ├── homepage/                         # 首页Tab路由
│   │   ├── discover/                         # 发现Tab路由  
│   │   ├── publish/                          # 发布Tab路由
│   │   ├── messages/                         # 消息Tab路由
│   │   └── profile/                          # 我的Tab路由
│   ├── modal/                                # 模态页面路由
│   ├── _layout.tsx                           # 根布局文件
│   └── +not-found.tsx                        # 404页面
├── src/                                      # 📦 源代码目录
│   └── features/Homepage/                    # 🏠 首页功能模块
├── components/                               # 🧩 全局共享组件 (Expo标准)
├── constants/                                # ⚙️ 全局常量 (Expo标准)
├── hooks/                                    # 🪝 全局Hook (Expo标准)
├── utils/                                    # 🛠️ 全局工具函数 (Expo标准)
├── assets/                                   # 🖼️ 静态资源 (Expo标准)
├── stores/                                   # 🔄 Zustand全局状态 (新增)
├── services/                                 # 📡 API服务层 (新增)
├── types/                                    # 📋 TypeScript类型 (新增)
├── app.json                                  # Expo配置文件
├── expo-env.d.ts                             # Expo类型声明
└── package.json                              # 依赖管理

### 🏠 **首页功能模块详细结构**

src/features/Homepage/                        # 📦 首页功能模块
│
├── 📱 【页面层 - Pages Layer】
│   ├── MainPage/                             # 🏠 首页主页面
│   ├── ServiceDetailPage/                    # 🎮 功能服务详情页面 (通用)
│   ├── EventCenterPage/                      # 🎤 组局中心页面
│   ├── FeaturedPage/                         # 💎 限时专享页面
│   ├── SearchPage/                           # 🔍 搜索页面
│   ├── LocationPage/                         # 📍 定位页面
│   ├── RegionPage/                           # 🗺️ 区域选择页面
│   ├── OnlineFilterPage/                     # 💻 线上筛选页面
│   └── OfflineFilterPage/                    # 🏪 线下筛选页面
│
├── 🧩 【组件层 - Components Layer】
│   ├── shared/                               # 共享组件库
│   │   ├── atoms/                            # 原子级组件
│   │   ├── molecules/                        # 分子级组件
│   │   ├── organisms/                        # 组织级组件
│   │   └── templates/                        # 页面模板组件
│   └── areas/                                # 页面区域组件
│       ├── TopFunctionArea/                  # 顶部功能区域
│       ├── ServiceGridArea/                  # 服务网格区域
│       ├── UserListArea/                     # 用户列表区域
│       └── FilterArea/                       # 筛选功能区域
│
├── 🔄 【状态层 - State Layer】
│   ├── stores/                               # Zustand状态存储
│   │   ├── homepageStore.js                  # 首页状态存储
│   │   ├── userStore.js                      # 用户数据存储
│   │   ├── filterStore.js                    # 筛选状态存储
│   │   ├── locationStore.js                  # 位置信息存储
│   │   ├── serviceStore.js                   # 服务状态存储 (新增)
│   │   └── configStore.js                    # 配置状态存储
│   └── actions/                              # 状态操作方法
│       ├── homepageActions.js                # 首页操作方法
│       ├── userActions.js                    # 用户操作方法
│       └── filterActions.js                  # 筛选操作方法
│
├── 📡 【数据层 - Data Layer】
│   ├── api/                                  # API接口层
│   │   ├── homepageApi.js                    # 首页API接口
│   │   ├── userApi.js                        # 用户API接口
│   │   ├── locationApi.js                    # 位置API接口
│   │   ├── serviceApi.js                     # 服务API接口 (新增)
│   │   └── configApi.js                      # 配置API接口
│   ├── services/                             # 业务服务层
│   │   ├── homepageService.js                # 首页业务服务
│   │   ├── userService.js                    # 用户业务服务
│   │   └── cacheService.js                   # 缓存服务
│   └── models/                               # 数据模型层
│       ├── userModel.js                      # 用户数据模型
│       ├── eventModel.js                     # 活动数据模型
│       └── filterModel.js                    # 筛选数据模型
│
├── 🧭 【路由层 - Routes Layer】 (Expo Router)
│   ├── routes/                               # 路由配置 (对应app/目录)
│   │   ├── homepageRoutes.ts                 # 首页路由配置
│   │   └── navigationActions.ts              # 导航操作方法
│   └── layouts/                              # 布局组件
│       ├── TabLayout.tsx                     # Tab布局组件
│       └── StackLayout.tsx                   # 堆栈布局组件
│
├── 🛠️ **【工具层 - Utils Layer】**
│   ├── helpers/                              # 工具函数
│   │   ├── formatHelper.js                   # 格式化工具
│   │   ├── validationHelper.js               # 验证工具
│   │   └── animationHelper.js                # 动画工具
│   ├── constants/                            # 常量定义
│   │   ├── homepageConstants.js              # 首页常量
│   │   ├── apiConstants.js                   # API常量
│   │   └── styleConstants.js                 # 样式常量
│   └── hooks/                                # 自定义Hook
│       ├── useHomepage.js                    # 首页Hook
│       ├── useUserList.js                    # 用户列表Hook
│       └── useFilter.js                      # 筛选Hook
│
└── 📋 【配置层 - Config Layer】
    ├── types/                                # TypeScript类型定义
    │   ├── homepageTypes.ts                  # 首页类型定义
    │   ├── userTypes.ts                      # 用户类型定义
    │   └── apiTypes.ts                       # API类型定义
    └── configs/                              # 配置文件
        ├── homepageConfig.js                 # 首页配置
        ├── apiConfig.js                      # API配置
        └── themeConfig.js                    # 主题配置
```

---

## 📱 **页面层架构规划**

### 🏠 **MainPage - 首页主页面**
```
功能职责：
- 作为首页模块的主入口页面
- 集成所有核心功能区域
- 管理页面级状态和导航

目录结构：
MainPage/
├── index.js                    # 页面主文件
├── components/                 # 页面专用组件
│   ├── TopBanner/              # 顶部横幅组件
│   ├── ServiceGrid/            # 服务网格组件
│   └── UserList/               # 用户列表组件
├── hooks/                      # 页面专用Hook
│   └── useMainPage.js          # 主页面Hook
└── styles/                     # 页面样式
    └── mainPageStyles.js       # 主页面样式

依赖关系：
- 状态层：homepageStore, userStore
- 组件层：shared组件库, areas区域组件
- 数据层：homepageApi, userApi
```

### 🎮 **ServiceDetailPage - 功能服务详情页面 (通用)**
```
功能职责：
- 通用功能服务详情展示 (王者荣耀/英雄联盟/探店/K歌等)
- 基于服务类型的用户筛选和列表
- 服务相关功能入口

目录结构：
ServiceDetailPage/
├── index.js                    # 页面主文件
├── components/                 # 服务页面专用组件
│   ├── ServiceHeader/          # 服务头部组件 (动态显示服务类型)
│   ├── ServiceFilter/          # 服务筛选组件 (根据服务类型配置)
│   ├── ServiceUserCard/        # 服务用户卡片 (适配不同服务)
│   └── ServiceTagList/         # 服务标签列表 (动态标签)
├── hooks/                      # 服务页面专用Hook
│   └── useServiceDetail.js     # 服务详情Hook
└── styles/                     # 服务页面样式
    └── serviceDetailStyles.js  # 服务详情样式

支持的服务类型：
- 游戏类：王者荣耀、英雄联盟、和平精英、荒野乱斗
- 生活类：探店、私影、台球、K歌、喝酒、按摩
- 其他：根据后端配置动态扩展

依赖关系：
- 状态层：userStore, filterStore, serviceStore
- 组件层：shared组件库, FilterArea
- 数据层：userApi, serviceApi
```

### 🔍 **SearchPage - 搜索页面**
```
功能职责：
- 智能搜索功能
- 搜索历史管理
- 搜索建议展示

目录结构：
SearchPage/
├── index.js                    # 页面主文件
├── components/                 # 搜索页面专用组件
│   ├── SearchHistory/          # 搜索历史组件
│   ├── SearchSuggestion/       # 搜索建议组件
│   └── SearchResults/          # 搜索结果组件
├── hooks/                      # 搜索页面专用Hook
│   └── useSearch.js            # 搜索Hook
└── styles/                     # 搜索页面样式
    └── searchPageStyles.js     # 搜索页面样式

依赖关系：
- 状态层：searchStore, userStore
- 组件层：shared组件库
- 数据层：searchApi, userApi
```

### 📍 **LocationPage + RegionPage - 位置服务页面**
```
功能职责：
- GPS定位管理
- 城市选择功能
- 位置权限处理

目录结构：
LocationPage/ + RegionPage/
├── index.js                    # 页面主文件
├── components/                 # 位置页面专用组件
│   ├── LocationPermission/     # 位置权限组件
│   ├── CitySelector/           # 城市选择组件
│   └── HotCities/              # 热门城市组件
├── hooks/                      # 位置页面专用Hook
│   └── useLocation.js          # 位置Hook
└── styles/                     # 位置页面样式
    └── locationPageStyles.js   # 位置页面样式

依赖关系：
- 状态层：locationStore
- 组件层：shared组件库
- 数据层：locationApi
```

### 💻🏪 **FilterPage - 筛选页面 (线上/线下)**
```
功能职责：
- 多维度筛选功能
- 筛选条件管理
- 实时结果预览

目录结构：
OnlineFilterPage/ + OfflineFilterPage/
├── index.js                    # 页面主文件
├── components/                 # 筛选页面专用组件
│   ├── FilterGroup/            # 筛选组组件
│   ├── PriceRange/             # 价格范围组件
│   └── FilterSummary/          # 筛选摘要组件
├── hooks/                      # 筛选页面专用Hook
│   └── useFilter.js            # 筛选Hook
└── styles/                     # 筛选页面样式
    └── filterPageStyles.js     # 筛选页面样式

依赖关系：
- 状态层：filterStore, userStore
- 组件层：shared组件库, FilterArea
- 数据层：filterApi, userApi
```

---

## 🔄 **状态层架构规划 (Zustand)**

### 📊 **状态存储结构设计**

#### 🏠 **homepageStore - 首页状态存储**
```
状态管理职责：
- 首页页面状态管理
- 组件配置状态
- 页面交互状态

状态结构预期：
{
  // 页面配置状态
  pageConfig: {
    topFunction: {},
    gameBanner: {},
    serviceGrid: {},
    featuredUsers: {},
    userList: {}
  },
  
  // 页面数据状态
  pageData: {
    featuredUsers: [],
    serviceItems: [],
    bannerData: {}
  },
  
  // 用户交互状态
  userInteraction: {
    selectedFilter: '',
    searchQuery: '',
    scrollPosition: 0
  }
}

操作方法：
- updatePageConfig()
- loadPageData()
- updateUserInteraction()
- resetPageState()
```

#### 👥 **userStore - 用户数据存储**
```
状态管理职责：
- 用户列表数据管理
- 用户详情缓存
- 用户筛选结果

状态结构预期：
{
  // 用户列表数据
  userList: {
    data: [],
    hasMore: false,
    loading: false,
    error: null
  },
  
  // 用户详情缓存
  userDetails: {},
  
  // 筛选结果
  filteredUsers: {
    data: [],
    totalCount: 0,
    appliedFilters: {}
  }
}

操作方法：
- loadUserList()
- loadMoreUsers()
- updateUserDetail()
- applyFilters()
```

#### 🔍 **filterStore - 筛选状态存储**
```
状态管理职责：
- 筛选条件管理
- 筛选历史记录
- 筛选结果统计

状态结构预期：
{
  // 当前筛选条件
  currentFilters: {
    location: '',
    gameType: '',
    priceRange: [],
    serviceType: ''
  },
  
  // 筛选历史
  filterHistory: [],
  
  // 筛选结果统计
  filterResults: {
    count: 0,
    loading: false
  }
}

操作方法：
- updateFilter()
- clearFilters()
- saveFilterPreset()
- loadFilterHistory()
```

#### 📍 **locationStore - 位置信息存储**
```
状态管理职责：
- 当前位置信息
- 位置权限状态
- 城市列表缓存

状态结构预期：
{
  // 当前位置
  currentLocation: {
    city: '',
    district: '',
    coordinates: {},
    accuracy: ''
  },
  
  // 权限状态
  permission: {
    status: 'pending',
    requestTime: null
  },
  
  // 城市数据
  cities: {
    hot: [],
    all: [],
    recent: []
  }
}

操作方法：
- updateLocation()
- requestPermission()
- loadCities()
- addRecentCity()
```

#### 🎮 **serviceStore - 服务状态存储**
```
状态管理职责：
- 服务类型配置管理
- 当前服务状态
- 服务相关数据缓存

状态结构预期：
{
  // 当前服务信息
  currentService: {
    serviceType: '', // 'honor_of_kings', 'explore_shop', 'ktv' 等
    serviceName: '',
    serviceConfig: {}
  },
  
  // 服务配置
  serviceConfigs: {
    'honor_of_kings': {
      displayName: '王者荣耀',
      filterOptions: [],
      userCardType: 'game',
      skillTags: []
    },
    'explore_shop': {
      displayName: '探店',
      filterOptions: [],
      userCardType: 'lifestyle',
      skillTags: []
    }
    // ... 其他服务配置
  },
  
  // 服务用户数据
  serviceUsers: {
    data: [],
    hasMore: false,
    loading: false
  }
}

操作方法：
- setCurrentService()
- loadServiceConfig()
- loadServiceUsers()
- updateServiceData()
```

#### ⚙️ **configStore - 配置状态存储**
```
状态管理职责：
- 组件配置缓存
- 主题配置管理
- 系统设置状态

状态结构预期：
{
  // 组件配置
  componentConfigs: {},
  
  // 主题配置
  theme: {
    colors: {},
    typography: {},
    spacing: {}
  },
  
  // 系统设置
  system: {
    networkStatus: 'online',
    appVersion: '1.0.0'
  }
}

操作方法：
- loadComponentConfig()
- updateTheme()
- updateSystemStatus()
- clearConfigCache()
```

---

## 📡 **数据层架构规划**

### 🔌 **API接口层设计**

#### 🏠 **homepageApi - 首页API接口**
```
接口职责：
- 首页数据获取
- 组件配置获取
- 页面埋点上报

主要接口：
- getHomepageData()          # 获取首页数据
- getComponentConfig()       # 获取组件配置
- getFeaturedUsers()         # 获取精选用户
- reportPageEvent()          # 上报页面事件
```

#### 👥 **userApi - 用户API接口**
```
接口职责：
- 用户列表获取
- 用户详情获取
- 用户筛选查询

主要接口：
- getUserList()              # 获取用户列表
- getUserDetail()            # 获取用户详情
- searchUsers()              # 搜索用户
- filterUsers()              # 筛选用户
```

#### 📍 **locationApi - 位置API接口**
```
接口职责：
- 位置信息获取
- 城市数据获取
- 距离计算服务

主要接口：
- getCurrentLocation()       # 获取当前位置
- getCityList()              # 获取城市列表
- calculateDistance()        # 计算距离
- reverseGeocode()           # 逆地理编码
```

#### 🎮 **serviceApi - 服务API接口**
```
接口职责：
- 服务配置获取
- 服务用户数据获取
- 服务相关操作

主要接口：
- getServiceConfig()         # 获取服务配置
- getServiceUsers()          # 获取服务用户列表
- getServiceDetail()         # 获取服务详情
- filterServiceUsers()       # 筛选服务用户
```

#### ⚙️ **configApi - 配置API接口**
```
接口职责：
- 组件配置获取
- 主题配置获取
- 系统配置管理

主要接口：
- getComponentConfig()       # 获取组件配置
- getThemeConfig()           # 获取主题配置
- updateUserPreference()     # 更新用户偏好
- getSystemConfig()          # 获取系统配置
```

### 🛠️ **服务层设计**

#### 🏠 **homepageService - 首页业务服务**
```
服务职责：
- 首页数据处理逻辑
- 数据缓存管理
- 数据格式化处理

主要功能：
- 数据聚合和处理
- 缓存策略实施
- 数据格式化转换
- 错误处理和重试
```

#### 💾 **cacheService - 缓存服务**
```
服务职责：
- 数据缓存管理
- 缓存策略控制
- 缓存失效处理

主要功能：
- 内存缓存管理
- 本地存储缓存
- 缓存失效机制
- 缓存同步策略
```

---

## 🧭 **路由层架构规划 (Expo Router)**

### 📱 **Expo Router文件系统路由**

#### 🗂️ **app/ 目录路由结构**
```
app/
├── _layout.tsx                      # 根布局 (TabLayout)
├── (tabs)/                          # Tab导航组
│   ├── _layout.tsx                  # Tab布局配置
│   ├── homepage/                    # 首页Tab路由
│   │   ├── _layout.tsx              # 首页堆栈布局
│   │   ├── index.tsx                # 首页主页面
│   │   ├── service-detail.tsx       # 功能服务详情页面 (通用)
│   │   ├── search.tsx               # 搜索页面
│   │   ├── location.tsx             # 定位页面
│   │   ├── region.tsx               # 区域选择页面
│   │   ├── filter-online.tsx        # 线上筛选页面
│   │   ├── filter-offline.tsx       # 线下筛选页面
│   │   ├── event-center.tsx         # 组局中心页面
│   │   └── featured.tsx             # 限时专享页面
│   ├── discover/                    # 发现Tab路由
│   │   └── index.tsx
│   ├── publish/                     # 发布Tab路由
│   │   └── index.tsx
│   ├── messages/                    # 消息Tab路由
│   │   └── index.tsx
│   └── profile/                     # 我的Tab路由
│       └── index.tsx
├── modal/                           # 模态页面路由
│   ├── user-detail.tsx              # 用户详情模态
│   ├── filter-panel.tsx             # 筛选面板模态
│   └── image-preview.tsx            # 图片预览模态
└── +not-found.tsx                   # 404页面
```

#### 🔗 **路由导航特性**
```
Expo Router特性：
- 基于文件系统的自动路由生成
- 类型安全的路由参数
- 自动代码分割和懒加载
- 深链接支持
- SEO友好的URL结构 (Web)

导航方式：
- router.push('/homepage/search')           # 堆栈推入
- router.replace('/homepage/location')      # 替换当前路由  
- router.back()                             # 返回上一页
- router.setParams({ userId: '123' })       # 设置路由参数
```

---

## 🎯 **技术架构约束**

### 📱 **Expo + React Native 约束**
```
Expo平台特性：
- 标准化的项目结构
- 内置开发工具链
- OTA更新支持
- 原生模块预集成
- 跨平台一致性保证

技术要求：
- Expo SDK 49+
- React Native 0.72+
- Expo Router (文件系统路由)
- Expo Constants (配置管理)
- EAS Build (云构建)
```

### 🐻 **Zustand 约束**
```
状态管理特性：
- 轻量级状态管理库
- 无需Provider包装
- TypeScript友好
- 中间件支持

技术要求：
- Zustand 4.4+
- 支持持久化中间件
- 支持开发者工具
- 支持异步状态更新
```

---

## 📊 **架构质量评估标准**

### 🎯 **架构完整性检查**
- [ ] 所有页面都有明确的目录结构规划
- [ ] 状态管理层设计合理清晰
- [ ] API接口层职责划分明确
- [ ] 导航结构符合用户体验
- [ ] 组件层级关系清晰
- [ ] 依赖关系设计合理

### 🔧 **技术栈一致性检查**
- [ ] Expo + React Native技术栈选择合理
- [ ] Zustand状态管理设计符合最佳实践  
- [ ] Expo Router路由方案设计合适
- [ ] 第三方库与Expo兼容性良好
- [ ] 性能优化策略考虑完整
- [ ] Expo标准目录结构清晰规范

### 📱 **可扩展性检查**
- [ ] 新页面添加流程清晰
- [ ] 新功能扩展路径明确
- [ ] 状态管理支持功能扩展
- [ ] 组件库支持复用扩展
- [ ] API层支持接口扩展
- [ ] 配置系统支持动态扩展

---

## 🚀 **下一步规划**

### 📋 **第2层设计准备**
在第1层架构通过审核后，将进入第2层设计：
1. **MainPage模块详细设计** - 首页组件详细设计
2. **ServiceDetailPage模块详细设计** - 通用服务页面组件设计
3. **SearchPage模块详细设计** - 搜索功能组件设计
4. **FilterPage模块详细设计** - 筛选功能组件设计
5. **共享组件库详细设计** - 通用组件详细设计

### 🎯 **架构优化方向**
根据审核反馈，可能的优化方向：
- 目录结构调整和优化
- 状态管理方案细化
- 组件层级关系优化
- API接口设计优化
- 性能优化策略调整

---

## 📞 **审核和反馈**

**当前状态**：等待第1层架构审核
**反馈方式**：请对以下方面提供意见
- Expo项目结构是否合理
- Expo Router路由设计是否恰当
- 状态管理设计是否符合预期  
- 页面划分是否合适
- 技术栈选择 (Expo + RN + Zustand) 是否适合
- 是否需要增加或删除某些模块

**修改计划**：根据审核反馈进行架构调整，确保第1层设计达到理想状态后再进入第2层设计阶段。

---

**© 2025 第1层首页模块宏观架构设计文档 - React Native + Zustand 技术栈**
