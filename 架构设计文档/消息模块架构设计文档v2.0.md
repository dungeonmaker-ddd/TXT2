# ğŸ’¬ æ¶ˆæ¯æ¨¡å—æ¶æ„è®¾è®¡æ–‡æ¡£ v2.0

> **åŸºäºUNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.5æ ‡å‡†**  
> **å®Œæ•´å‰åç«¯ä¸€ä½“åŒ– + å±‚çº§åŒ–é¡µé¢ç»„æ¶æ„ + å…«æ®µå¼ä»£ç è§„èŒƒ**

---

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- **æ¨¡å—åç§°**ï¼šMessagesï¼ˆæ¶ˆæ¯æ¨¡å—ï¼‰
- **é¡µé¢ç±»å‹**ï¼šæ¶ˆæ¯é€šä¿¡ã€é€šçŸ¥ç®¡ç†ã€ç¤¾äº¤äº’åŠ¨
- **è®¾è®¡æ ‡å‡†**ï¼šUNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.5
- **åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´
- **ç‰ˆæœ¬å·**ï¼šv2.0
- **é€‚ç”¨é¡¹ç›®**ï¼šXiangYuPaiæ¢åº—APP
- **æŠ€æœ¯æ ˆ**ï¼šReact Native + Expo Router + TypeScript + MyBatis-Plus

---

## ğŸ¯ æ ¸å¿ƒè®¾è®¡åŸåˆ™éµå¾ªæ£€æŸ¥æ¸…å•

### âœ… æ¶æ„æ ‡å‡†å¼ºåˆ¶æ‰§è¡Œé¡¹

- [x] **å±‚çº§åŒ–é¡µé¢ç»„ä¸»å¯¼æ¶æ„** - MainPage + SubPagesç»“æ„
- [x] **å‰åç«¯ä¸€ä½“åŒ–å¼ºåˆ¶å®æ–½** - APIå±‚ä¸åç«¯å®ç°å±‚åŒæ—¶å®Œæ•´äº¤ä»˜
- [x] **MyBatis-Plusæ ‡å‡†æ¶æ„** - QueryWrapper/LambdaQueryWrapperæŸ¥è¯¢
- [x] **å…«æ®µå¼ä»£ç ç»“æ„** - æ‰€æœ‰ä¸»æ–‡ä»¶éµå¾ªå…«æ®µå¼è§„èŒƒ
- [x] **ä¸»æ–‡ä»¶ä¼˜å…ˆåŸåˆ™** - çŠ¶æ€/äº‹ä»¶/æ•°æ®å¤„ç†é›†ä¸­åœ¨ä¸»æ–‡ä»¶å†…
- [x] **æŒ‰éœ€è®¾è®¡åŸåˆ™** - ä»…åˆ›å»ºå‰ç«¯å®é™…éœ€è¦çš„æ¥å£
- [x] **ç±»å‹å®‰å…¨** - å®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰
- [x] **å¸¸é‡è§„èŒƒ** - æ‰€æœ‰å¸¸é‡åœ¨constants.[ext]ä¸­å®šä¹‰

---

## ğŸ“¦ ä¸€ã€æ¨¡å—æ¶æ„æ€»è§ˆ

### 1.1 é¡µé¢ç»„å±‚çº§ç»“æ„

```
src/pages/Messages/                        # ğŸ“¦ æ¶ˆæ¯æ¨¡å—é¡µé¢ç»„
â”œâ”€â”€ index.tsx                               # ğŸ¯ é¡µé¢ç»„ä¸»æ–‡ä»¶ - çŠ¶æ€ç®¡ç†ã€å¯¼èˆªåè°ƒ
â”œâ”€â”€ types.ts                                # ğŸ“‹ é¡µé¢ç»„ç±»å‹å®šä¹‰
â”œâ”€â”€ constants.ts                            # âš™ï¸ é¡µé¢ç»„å¸¸é‡é…ç½®
â”œâ”€â”€ README.md                               # ğŸ“– é¡µé¢ç»„æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸ  ä¸»é¡µé¢å±‚ (Main Page)
â”‚   â”œâ”€â”€ MainPage/                           # ğŸ“± æ¶ˆæ¯ä¸»é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.tsx                       # ä¸»é¡µé¢å®ç°ï¼ˆå…«æ®µå¼ç»“æ„ï¼‰
â”‚   â”‚   â”œâ”€â”€ types.ts                        # ä¸»é¡µé¢ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ constants.ts                    # ä¸»é¡µé¢å¸¸é‡é…ç½®
â”‚   â”‚   â”œâ”€â”€ README.md                       # ä¸»é¡µé¢æ–‡æ¡£
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ NavigationArea/                 # âœ… å¯¼èˆªæ åŒºåŸŸç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx                   # ğŸ¯ åŒºåŸŸç»„ä»¶ä¸»æ–‡ä»¶ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ README.md                   # åŒºåŸŸæ–‡æ¡£
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ CategoryArea/                   # âœ… 4å®«æ ¼åˆ†ç±»åŒºåŸŸç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ index.tsx                   # ğŸ¯ åŒºåŸŸç»„ä»¶ä¸»æ–‡ä»¶ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts                    # åŒºåŸŸç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ constants.ts                # åŒºåŸŸå¸¸é‡é…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ README.md                   # åŒºåŸŸæ–‡æ¡£
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ConversationArea/               # âœ… å¯¹è¯åˆ—è¡¨åŒºåŸŸç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ index.tsx                   # ğŸ¯ åŒºåŸŸç»„ä»¶ä¸»æ–‡ä»¶ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚       â”œâ”€â”€ types.ts                    # åŒºåŸŸç±»å‹å®šä¹‰
â”‚   â”‚       â”œâ”€â”€ constants.ts                # åŒºåŸŸå¸¸é‡é…ç½®
â”‚   â”‚       â””â”€â”€ README.md                   # åŒºåŸŸæ–‡æ¡£
â”‚   â”‚
â”œâ”€â”€ ğŸ“„ å­é¡µé¢å±‚ (Sub Pages)
â”‚   â”œâ”€â”€ LikesPage/                          # èµå’Œæ”¶è—æ¶ˆæ¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.tsx                       # é¡µé¢å®ç°ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ types.ts                        # é¡µé¢ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ constants.ts                    # é¡µé¢å¸¸é‡é…ç½®
â”‚   â”‚   â””â”€â”€ README.md                       # é¡µé¢æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ CommentsPage/                       # è¯„è®ºæ¶ˆæ¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.tsx                       # é¡µé¢å®ç°ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ types.ts                        # é¡µé¢ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ constants.ts                    # é¡µé¢å¸¸é‡é…ç½®
â”‚   â”‚   â””â”€â”€ README.md                       # é¡µé¢æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ FollowersPage/                      # ç²‰ä¸æ¶ˆæ¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.tsx                       # é¡µé¢å®ç°ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ types.ts                        # é¡µé¢ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ constants.ts                    # é¡µé¢å¸¸é‡é…ç½®
â”‚   â”‚   â””â”€â”€ README.md                       # é¡µé¢æ–‡æ¡£
â”‚   â”‚
â”‚   â”œâ”€â”€ NotificationsPage/                  # ç³»ç»Ÿé€šçŸ¥é¡µé¢
â”‚   â”‚   â”œâ”€â”€ index.tsx                       # é¡µé¢å®ç°ï¼ˆå…«æ®µå¼ï¼‰
â”‚   â”‚   â”œâ”€â”€ types.ts                        # é¡µé¢ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ constants.ts                    # é¡µé¢å¸¸é‡é…ç½®
â”‚   â”‚   â””â”€â”€ README.md                       # é¡µé¢æ–‡æ¡£
â”‚   â”‚
â”‚   â””â”€â”€ ChatPage/                           # ç§èŠå¯¹è¯é¡µé¢
â”‚       â”œâ”€â”€ index.tsx                       # é¡µé¢å®ç°ï¼ˆå…«æ®µå¼ï¼‰
â”‚       â”œâ”€â”€ types.ts                        # é¡µé¢ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ constants.ts                    # é¡µé¢å¸¸é‡é…ç½®
â”‚       â””â”€â”€ README.md                       # é¡µé¢æ–‡æ¡£
â”‚
â”œâ”€â”€ ğŸŒ APIæ¥å£å±‚ï¼ˆå‰ç«¯ï¼‰
â”‚   â”œâ”€â”€ apiMessagesMain.ts                  # æ¶ˆæ¯ä¸»é¡µé¢API
â”‚   â”œâ”€â”€ apiMessagesLikes.ts                 # èµå’Œæ”¶è—API
â”‚   â”œâ”€â”€ apiMessagesComments.ts              # è¯„è®ºAPI
â”‚   â”œâ”€â”€ apiMessagesFollowers.ts             # ç²‰ä¸API
â”‚   â”œâ”€â”€ apiMessagesNotifications.ts         # ç³»ç»Ÿé€šçŸ¥API
â”‚   â”œâ”€â”€ apiMessagesChat.ts                  # ç§èŠå¯¹è¯API
â”‚   â””â”€â”€ apiMessagesAggregate.ts             # èšåˆAPIï¼ˆå¯é€‰ï¼‰
â”‚
â””â”€â”€ ğŸ”Œ åç«¯äº¤äº’å±‚ï¼ˆJava/Kotlin + MyBatis-Plusï¼‰
    â””â”€â”€ backend/
        â”œâ”€â”€ entityMessage.java              # ğŸ—ï¸ æ¶ˆæ¯å®ä½“ï¼ˆMyBatis-Plusï¼‰
        â”œâ”€â”€ entityConversation.java         # ğŸ—ï¸ å¯¹è¯å®ä½“
        â”œâ”€â”€ entityNotification.java         # ğŸ—ï¸ é€šçŸ¥å®ä½“
        â”œâ”€â”€ dtoMessageCreate.java           # ğŸ“¦ åˆ›å»ºæ¶ˆæ¯DTO
        â”œâ”€â”€ dtoMessageUpdate.java           # ğŸ“¦ æ›´æ–°æ¶ˆæ¯DTO
        â”œâ”€â”€ voMessageQuery.java             # ğŸ” æ¶ˆæ¯æŸ¥è¯¢VO
        â”œâ”€â”€ controllerMessages.java         # ğŸ¯ æ¶ˆæ¯æ§åˆ¶å™¨
        â”œâ”€â”€ serviceMessages.java            # âš™ï¸ æ¶ˆæ¯æœåŠ¡æ¥å£
        â”œâ”€â”€ serviceImplMessages.java        # ğŸ”§ æ¶ˆæ¯æœåŠ¡å®ç°ï¼ˆQueryWrapperï¼‰
        â”œâ”€â”€ mapperMessages.java             # ğŸ—„ï¸ æ¶ˆæ¯Mapperæ¥å£
        â””â”€â”€ queryMessagesBuilder.java       # ğŸ—ï¸ æŸ¥è¯¢æ„å»ºå™¨ï¼ˆå¯é€‰ï¼‰
```

### 1.2 é¡µé¢å±‚çº§è¯´æ˜

| å±‚çº§ | å‘½åè§„èŒƒ | èŒè´£ | ç¤ºä¾‹ |
|------|---------|------|------|
| **é¡µé¢ç»„** | `Messages/` | å®Œæ•´ä¸šåŠ¡æ¨¡å— | æ¶ˆæ¯é€šä¿¡æ¨¡å— |
| **ä¸»é¡µé¢** | `MainPage/` | æ¨¡å—ä¸»å…¥å£ | æ¶ˆæ¯ä¸»é¡µé¢ |
| **å­é¡µé¢** | `{SubFunction}Page/` | å­åŠŸèƒ½é¡µé¢ | `LikesPage/`, `ChatPage/` |
| **åŒºåŸŸç»„ä»¶** | `{ComponentAreaName}/` | é¡µé¢åŠŸèƒ½åŒºåŸŸ | `CategoryArea/`, `ConversationArea/` |

---

## ğŸ“‹ äºŒã€æ ¸å¿ƒç±»å‹å®šä¹‰ï¼ˆtypes.tsï¼‰

### 2.1 é¡µé¢ç»„çº§åˆ«ç±»å‹

```typescript
// é¡µé¢ç»„Propsæ¥å£
export interface MessagesProps {
  initialTab?: MessageTab;
  userId?: string;
}

// é¡µé¢ç»„çŠ¶æ€ç±»å‹
export interface MessagesState {
  activeTab: MessageTab;
  unreadCounts: UnreadCounts;
  isLoading: boolean;
}

// Tabç±»å‹
export type MessageTab = 'main' | 'likes' | 'comments' | 'followers' | 'notifications' | 'chat';

// æœªè¯»æ•°é‡ç»Ÿè®¡
export interface UnreadCounts {
  likes: number;
  comments: number;
  followers: number;
  notifications: number;
  conversations: number;
  total: number;
}
```

### 2.2 æ•°æ®å®ä½“ç±»å‹

```typescript
// æ¶ˆæ¯å®ä½“ç±»å‹
export interface Message {
  id: string;
  type: MessageType;
  senderId: string;
  receiverId: string;
  content: string;
  contentType: ContentType;
  status: MessageStatus;
  isRead: boolean;
  createdAt: number;
  updatedAt: number;
}

// å¯¹è¯å®ä½“ç±»å‹
export interface Conversation {
  id: string;
  userId: string;
  userAvatar: string;
  userName: string;
  lastMessage: string;
  lastMessageTime: number;
  unreadCount: number;
  isRead: boolean;
  isOnline: boolean;
}

// é€šçŸ¥å®ä½“ç±»å‹
export interface Notification {
  id: string;
  type: NotificationType;
  title: string;
  content: string;
  priority: NotificationPriority;
  actionUrl?: string;
  actionLabel?: string;
  isRead: boolean;
  createdAt: number;
}

// ç‚¹èµæ”¶è—æ¶ˆæ¯ç±»å‹
export interface LikeMessage {
  id: string;
  userId: string;
  userAvatar: string;
  userName: string;
  actionType: 'like' | 'collect';
  targetType: 'post' | 'comment';
  targetId: string;
  targetContent: string;
  targetThumbnail?: string;
  createdAt: number;
}

// è¯„è®ºæ¶ˆæ¯ç±»å‹
export interface CommentMessage {
  id: string;
  userId: string;
  userAvatar: string;
  userName: string;
  commentContent: string;
  targetType: 'post' | 'comment';
  targetId: string;
  targetContent: string;
  targetThumbnail?: string;
  createdAt: number;
}

// ç²‰ä¸æ¶ˆæ¯ç±»å‹
export interface FollowerMessage {
  id: string;
  userId: string;
  userAvatar: string;
  userName: string;
  userBio?: string;
  followStatus: FollowStatus;
  createdAt: number;
}
```

### 2.3 æšä¸¾ç±»å‹

```typescript
// æ¶ˆæ¯ç±»å‹
export enum MessageType {
  TEXT = 'text',
  IMAGE = 'image',
  VOICE = 'voice',
  VIDEO = 'video',
}

// å†…å®¹ç±»å‹
export enum ContentType {
  TEXT = 'text',
  IMAGE = 'image',
  VOICE = 'voice',
  VIDEO = 'video',
}

// æ¶ˆæ¯çŠ¶æ€
export enum MessageStatus {
  SENDING = 'sending',
  SENT = 'sent',
  DELIVERED = 'delivered',
  READ = 'read',
  FAILED = 'failed',
}

// é€šçŸ¥ç±»å‹
export enum NotificationType {
  SYSTEM = 'system',
  ACTIVITY = 'activity',
  UPDATE = 'update',
}

// é€šçŸ¥ä¼˜å…ˆçº§
export enum NotificationPriority {
  HIGH = 'high',
  NORMAL = 'normal',
  LOW = 'low',
}

// å…³æ³¨çŠ¶æ€
export enum FollowStatus {
  NOT_FOLLOWING = 'not_following',
  FOLLOWING = 'following',
  MUTUAL = 'mutual',
}
```

### 2.4 APIäº¤äº’ç±»å‹

```typescript
// APIå“åº”ç±»å‹
export interface ApiResponse<T> {
  code: number;
  message: string;
  data: T;
}

// åˆ†é¡µæŸ¥è¯¢å‚æ•°
export interface PageQuery {
  page: number;
  pageSize: number;
}

// åˆ†é¡µå“åº”ç±»å‹
export interface PageResponse<T> {
  list: T[];
  total: number;
  page: number;
  pageSize: number;
  hasMore: boolean;
}

// æ¶ˆæ¯åˆ—è¡¨å“åº”
export type MessageListResponse = PageResponse<Message>;
export type ConversationListResponse = PageResponse<Conversation>;
export type NotificationListResponse = PageResponse<Notification>;
export type LikeMessageListResponse = PageResponse<LikeMessage>;
export type CommentMessageListResponse = PageResponse<CommentMessage>;
export type FollowerMessageListResponse = PageResponse<FollowerMessage>;
```

### 2.5 ç»„ä»¶Propsç±»å‹

```typescript
// CategoryArea Props
export interface CategoryAreaProps {
  unreadCounts: UnreadCounts;
  onCategoryPress: (category: string) => void;
  style?: StyleProp<ViewStyle>;
}

// ConversationArea Props
export interface ConversationAreaProps {
  conversations: Conversation[];
  onConversationPress: (id: string) => void;
  onConversationDelete: (id: string) => void;
  onRefresh: () => void;
  refreshing: boolean;
  style?: StyleProp<ViewStyle>;
}

// MessageItem Props
export interface MessageItemProps {
  id: string;
  type: 'conversation' | 'like' | 'comment' | 'follower' | 'notification';
  avatar: string;
  title: string;
  subtitle: string;
  thumbnail?: string;
  timestamp: number;
  isRead: boolean;
  unreadCount?: number;
  actionButton?: {
    label: string;
    onPress: () => void;
  };
  onPress: () => void;
  onLongPress?: () => void;
  onDelete?: () => void;
  style?: StyleProp<ViewStyle>;
}
```

---

## âš™ï¸ ä¸‰ã€å¸¸é‡é…ç½®ï¼ˆconstants.tsï¼‰

### 3.1 UIå°ºå¯¸å¸¸é‡

```typescript
export const UI_SIZES = {
  SYSTEM_STATUS_BAR_HEIGHT: 44,
  NAVIGATION_BAR_HEIGHT: 56,
  BOTTOM_TAB_BAR_HEIGHT: 80,
  SAFE_AREA_BOTTOM: 34,
  
  // åˆ†ç±»å¡ç‰‡
  CATEGORY_CARD_SIZE: 80,
  CATEGORY_CARD_SPACING: 16,
  CATEGORY_ICON_SIZE: 32,
  
  // å¤´åƒå°ºå¯¸
  USER_AVATAR_SIZE: 48,
  USER_AVATAR_SIZE_SMALL: 36,
  USER_AVATAR_SIZE_LARGE: 64,
  
  // æ¶ˆæ¯é¡¹
  MESSAGE_ITEM_HEIGHT: 80,
  MESSAGE_THUMBNAIL_SIZE: 48,
  
  // å¡ç‰‡è¾¹è·
  CARD_PADDING_HORIZONTAL: 16,
  CARD_PADDING_VERTICAL: 12,
  
  // åœ†è§’
  BORDER_RADIUS_SMALL: 6,
  BORDER_RADIUS_MEDIUM: 8,
  BORDER_RADIUS_LARGE: 12,
  BORDER_RADIUS_XLARGE: 16,
  
  // è§’æ ‡
  BADGE_SIZE: 14,
  BADGE_LARGE_SIZE: 16,
} as const;
```

### 3.2 é¢œè‰²å¸¸é‡

```typescript
export const COLORS = {
  // ä¸»è‰²è°ƒ
  PRIMARY: '#8A2BE2',
  PRIMARY_LIGHT: '#9D4EDD',
  PRIMARY_DARK: '#7209B7',
  
  // æ–‡å­—é¢œè‰²
  TEXT_PRIMARY: '#000000',
  TEXT_SECONDARY: '#666666',
  TEXT_TERTIARY: '#999999',
  TEXT_PLACEHOLDER: '#CCCCCC',
  TEXT_WHITE: '#FFFFFF',
  
  // èƒŒæ™¯é¢œè‰²
  BACKGROUND_WHITE: '#FFFFFF',
  BACKGROUND_GRAY: '#F5F5F5',
  BACKGROUND_DARK: '#F0F0F0',
  
  // åˆ†éš”çº¿
  BORDER_LIGHT: '#E5E5E5',
  BORDER_MEDIUM: '#DDDDDD',
  BORDER_DARK: '#CCCCCC',
  
  // åŠŸèƒ½è‰²
  SUCCESS: '#34C759',
  WARNING: '#FF9500',
  ERROR: '#FF3B30',
  INFO: '#007AFF',
  
  // åˆ†ç±»å¡ç‰‡é¢œè‰²
  CATEGORY_LIKES: '#FF69B4',
  CATEGORY_COMMENTS: '#4A90E2',
  CATEGORY_FOLLOWERS: '#FF8C00',
  CATEGORY_NOTIFICATIONS: '#5856D6',
  
  // çŠ¶æ€è‰²
  ONLINE: '#34C759',
  OFFLINE: '#999999',
  UNREAD: '#FF3B30',
  READ: '#999999',
} as const;
```

### 3.3 åŠ¨ç”»æ—¶é•¿å¸¸é‡

```typescript
export const ANIMATION_DURATION = {
  SHORT: 200,
  MEDIUM: 300,
  LONG: 500,
  EXTRA_LONG: 800,
} as const;
```

### 3.4 ä¸šåŠ¡é…ç½®å¸¸é‡

```typescript
export const MESSAGES_CONFIG = {
  // åˆ†é¡µé…ç½®
  PAGE_SIZE: 20,
  
  // æ—¶é—´æ ¼å¼
  TIME_FORMAT: {
    JUST_NOW: 'åˆšåˆš',
    MINUTES_AGO: (m: number) => `${m}åˆ†é’Ÿå‰`,
    HOURS_AGO: (h: number) => `${h}å°æ—¶å‰`,
    YESTERDAY: 'æ˜¨å¤©',
    DATE_FORMAT: 'MM-DD',
  },
  
  // æœªè¯»æ•°é‡æ˜¾ç¤º
  UNREAD_COUNT_MAX: 99,
  UNREAD_COUNT_OVERFLOW: '99+',
  
  // æ¶ˆæ¯å†…å®¹é¢„è§ˆé•¿åº¦
  MESSAGE_PREVIEW_LENGTH: 50,
  
  // åˆ·æ–°é…ç½®
  PULL_REFRESH_THRESHOLD: 80,
  AUTO_REFRESH_INTERVAL: 60000, // 60ç§’
  
  // WebSocketé…ç½®
  WS_RECONNECT_INTERVAL: 3000,
  WS_MAX_RECONNECT_ATTEMPTS: 5,
} as const;

// åˆ†ç±»é…ç½®
export const CATEGORIES = [
  {
    id: 'likes',
    title: 'èµå’Œæ”¶è—',
    icon: 'heart',
    color: COLORS.CATEGORY_LIKES,
    route: '/messages/likes',
  },
  {
    id: 'comments',
    title: 'è¯„è®º',
    icon: 'message',
    color: COLORS.CATEGORY_COMMENTS,
    route: '/messages/comments',
  },
  {
    id: 'followers',
    title: 'ç²‰ä¸',
    icon: 'users',
    color: COLORS.CATEGORY_FOLLOWERS,
    route: '/messages/followers',
  },
  {
    id: 'notifications',
    title: 'ç³»ç»Ÿé€šçŸ¥',
    icon: 'bell',
    color: COLORS.CATEGORY_NOTIFICATIONS,
    route: '/messages/notifications',
  },
] as const;
```

### 3.5 APIé…ç½®å¸¸é‡

```typescript
export const API_CONFIG = {
  BASE_URL: '/api/v1/messages',
  TIMEOUT: 10000,
  PAGE_SIZE: 20,
  
  ENDPOINTS: {
    // ä¸»é¡µé¢
    CONVERSATIONS_LIST: '/conversations',
    UNREAD_COUNTS: '/unread/counts',
    
    // å­åŠŸèƒ½
    LIKES_LIST: '/likes',
    COMMENTS_LIST: '/comments',
    FOLLOWERS_LIST: '/followers',
    NOTIFICATIONS_LIST: '/notifications',
    
    // å¯¹è¯
    CHAT_MESSAGES: '/chat/:conversationId/messages',
    SEND_MESSAGE: '/chat/:conversationId/send',
    
    // æ“ä½œ
    MARK_READ: '/:id/read',
    DELETE_MESSAGE: '/:id',
    CLEAR_ALL: '/:type/clear',
  },
} as const;
```

---

## ğŸŒ å››ã€å‰ç«¯APIæ¥å£å±‚è®¾è®¡

### 4.1 ä¸»é¡µé¢APIï¼ˆapiMessagesMain.tsï¼‰

```typescript
import { ApiResponse, PageQuery, ConversationListResponse, UnreadCounts } from './types';
import { API_CONFIG } from './constants';

/**
 * è·å–å¯¹è¯åˆ—è¡¨
 */
export async function getConversationList(
  params: PageQuery
): Promise<ApiResponse<ConversationListResponse>> {
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.CONVERSATIONS_LIST}?page=${params.page}&pageSize=${params.pageSize}`,
    {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}

/**
 * è·å–æœªè¯»æ¶ˆæ¯æ•°é‡ç»Ÿè®¡
 */
export async function getUnreadCounts(): Promise<ApiResponse<UnreadCounts>> {
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.UNREAD_COUNTS}`,
    {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}

/**
 * æ ‡è®°å¯¹è¯ä¸ºå·²è¯»
 */
export async function markConversationRead(
  conversationId: string
): Promise<ApiResponse<void>> {
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.MARK_READ.replace(':id', conversationId)}`,
    {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}

/**
 * åˆ é™¤å¯¹è¯
 */
export async function deleteConversation(
  conversationId: string
): Promise<ApiResponse<void>> {
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.DELETE_MESSAGE.replace(':id', conversationId)}`,
    {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}
```

### 4.2 èµå’Œæ”¶è—APIï¼ˆapiMessagesLikes.tsï¼‰

```typescript
import { ApiResponse, PageQuery, LikeMessageListResponse } from './types';
import { API_CONFIG } from './constants';

/**
 * è·å–èµå’Œæ”¶è—æ¶ˆæ¯åˆ—è¡¨
 */
export async function getLikeMessageList(
  params: PageQuery
): Promise<ApiResponse<LikeMessageListResponse>> {
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.LIKES_LIST}?page=${params.page}&pageSize=${params.pageSize}`,
    {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}

/**
 * æ¸…ç©ºæ‰€æœ‰èµå’Œæ”¶è—æ¶ˆæ¯
 */
export async function clearAllLikeMessages(): Promise<ApiResponse<void>> {
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${API_CONFIG.ENDPOINTS.CLEAR_ALL.replace(':type', 'likes')}`,
    {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}
```

### 4.3 ç§èŠå¯¹è¯APIï¼ˆapiMessagesChat.tsï¼‰

```typescript
import { ApiResponse, PageQuery, Message, MessageListResponse } from './types';
import { API_CONFIG } from './constants';

/**
 * è·å–å¯¹è¯æ¶ˆæ¯åˆ—è¡¨
 */
export async function getChatMessages(
  conversationId: string,
  params: PageQuery
): Promise<ApiResponse<MessageListResponse>> {
  const url = API_CONFIG.ENDPOINTS.CHAT_MESSAGES.replace(':conversationId', conversationId);
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${url}?page=${params.page}&pageSize=${params.pageSize}`,
    {
      method: 'GET',
      headers: {
        'Content-Type': 'application/json',
      },
    }
  );
  
  return response.json();
}

/**
 * å‘é€æ¶ˆæ¯
 */
export async function sendMessage(
  conversationId: string,
  content: string,
  contentType: string
): Promise<ApiResponse<Message>> {
  const url = API_CONFIG.ENDPOINTS.SEND_MESSAGE.replace(':conversationId', conversationId);
  const response = await fetch(
    `${API_CONFIG.BASE_URL}${url}`,
    {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        content,
        contentType,
      }),
    }
  );
  
  return response.json();
}
```

---

## ğŸ”Œ äº”ã€åç«¯äº¤äº’å±‚è®¾è®¡ï¼ˆMyBatis-Plusæ ‡å‡†ï¼‰

### 5.1 æ•°æ®å®ä½“ï¼ˆentityMessage.javaï¼‰

```java
import com.baomidou.mybatisplus.annotation.*;
import lombok.Data;
import java.time.LocalDateTime;

@Data
@TableName("messages")
public class MessageEntity {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String type;
    private Long senderId;
    private Long receiverId;
    private String content;
    private String contentType;
    private String status;
    private Boolean isRead;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createdAt;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updatedAt;
}

@Data
@TableName("conversations")
public class ConversationEntity {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private Long userId;
    private String lastMessage;
    private LocalDateTime lastMessageTime;
    private Integer unreadCount;
    private Boolean isRead;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createdAt;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updatedAt;
}

@Data
@TableName("notifications")
public class NotificationEntity {
    @TableId(type = IdType.AUTO)
    private Long id;
    
    private String type;
    private String title;
    private String content;
    private String priority;
    private String actionUrl;
    private String actionLabel;
    private Boolean isRead;
    
    @TableField(fill = FieldFill.INSERT)
    private LocalDateTime createdAt;
    
    @TableField(fill = FieldFill.INSERT_UPDATE)
    private LocalDateTime updatedAt;
}
```

### 5.2 æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆdtoMessageCreate.javaï¼‰

```java
import lombok.Data;
import javax.validation.constraints.*;

@Data
public class MessageCreateDTO {
    @NotNull(message = "æ¥æ”¶è€…IDä¸èƒ½ä¸ºç©º")
    private Long receiverId;
    
    @NotBlank(message = "æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º")
    @Size(max = 1000, message = "æ¶ˆæ¯å†…å®¹ä¸èƒ½è¶…è¿‡1000å­—ç¬¦")
    private String content;
    
    @NotBlank(message = "å†…å®¹ç±»å‹ä¸èƒ½ä¸ºç©º")
    private String contentType;
}

@Data
public class MessageUpdateDTO {
    @NotNull(message = "æ¶ˆæ¯IDä¸èƒ½ä¸ºç©º")
    private Long id;
    
    private Boolean isRead;
    private String status;
}
```

### 5.3 æŸ¥è¯¢è§†å›¾å¯¹è±¡ï¼ˆvoMessageQuery.javaï¼‰

```java
import lombok.Data;

@Data
public class MessageQueryVO {
    private Integer page = 1;
    private Integer pageSize = 20;
    
    // æŸ¥è¯¢æ¡ä»¶
    private Long userId;
    private String type;
    private Boolean isRead;
    private Long startTime;
    private Long endTime;
    
    // æ’åº
    private String sortBy = "created_at";
    private String sortOrder = "DESC";
}
```

### 5.4 æ§åˆ¶å™¨ï¼ˆcontrollerMessages.javaï¼‰

```java
import org.springframework.web.bind.annotation.*;
import org.springframework.beans.factory.annotation.Autowired;
import javax.validation.Valid;

@RestController
@RequestMapping("/api/v1/messages")
public class MessagesController {
    
    @Autowired
    private MessagesService messagesService;
    
    /**
     * è·å–å¯¹è¯åˆ—è¡¨
     */
    @GetMapping("/conversations")
    public ApiResponse<PageResult<ConversationEntity>> getConversationList(
        @RequestParam Integer page,
        @RequestParam Integer pageSize
    ) {
        PageResult<ConversationEntity> result = messagesService.getConversationList(page, pageSize);
        return ApiResponse.success(result);
    }
    
    /**
     * è·å–æœªè¯»æ¶ˆæ¯æ•°é‡ç»Ÿè®¡
     */
    @GetMapping("/unread/counts")
    public ApiResponse<UnreadCounts> getUnreadCounts() {
        UnreadCounts counts = messagesService.getUnreadCounts();
        return ApiResponse.success(counts);
    }
    
    /**
     * è·å–å¯¹è¯æ¶ˆæ¯åˆ—è¡¨
     */
    @GetMapping("/chat/{conversationId}/messages")
    public ApiResponse<PageResult<MessageEntity>> getChatMessages(
        @PathVariable Long conversationId,
        @RequestParam Integer page,
        @RequestParam Integer pageSize
    ) {
        PageResult<MessageEntity> result = messagesService.getChatMessages(conversationId, page, pageSize);
        return ApiResponse.success(result);
    }
    
    /**
     * å‘é€æ¶ˆæ¯
     */
    @PostMapping("/chat/{conversationId}/send")
    public ApiResponse<MessageEntity> sendMessage(
        @PathVariable Long conversationId,
        @Valid @RequestBody MessageCreateDTO dto
    ) {
        MessageEntity message = messagesService.sendMessage(conversationId, dto);
        return ApiResponse.success(message);
    }
    
    /**
     * æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»
     */
    @PutMapping("/{id}/read")
    public ApiResponse<Void> markRead(@PathVariable Long id) {
        messagesService.markRead(id);
        return ApiResponse.success();
    }
    
    /**
     * åˆ é™¤æ¶ˆæ¯
     */
    @DeleteMapping("/{id}")
    public ApiResponse<Void> deleteMessage(@PathVariable Long id) {
        messagesService.deleteMessage(id);
        return ApiResponse.success();
    }
    
    /**
     * æ¸…ç©ºæŸç±»æ¶ˆæ¯
     */
    @DeleteMapping("/{type}/clear")
    public ApiResponse<Void> clearAll(@PathVariable String type) {
        messagesService.clearAll(type);
        return ApiResponse.success();
    }
}
```

### 5.5 æœåŠ¡æ¥å£ï¼ˆserviceMessages.javaï¼‰

```java
public interface MessagesService {
    PageResult<ConversationEntity> getConversationList(Integer page, Integer pageSize);
    UnreadCounts getUnreadCounts();
    PageResult<MessageEntity> getChatMessages(Long conversationId, Integer page, Integer pageSize);
    MessageEntity sendMessage(Long conversationId, MessageCreateDTO dto);
    void markRead(Long id);
    void deleteMessage(Long id);
    void clearAll(String type);
}
```

### 5.6 æœåŠ¡å®ç°ï¼ˆserviceImplMessages.javaï¼‰

```java
import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import org.springframework.stereotype.Service;
import org.springframework.beans.factory.annotation.Autowired;

@Service
public class MessagesServiceImpl implements MessagesService {
    
    @Autowired
    private MessagesMapper messagesMapper;
    
    @Autowired
    private ConversationsMapper conversationsMapper;
    
    @Override
    public PageResult<ConversationEntity> getConversationList(Integer page, Integer pageSize) {
        // ä½¿ç”¨LambdaQueryWrapperæŸ¥è¯¢
        LambdaQueryWrapper<ConversationEntity> wrapper = new LambdaQueryWrapper<>();
        wrapper.orderByDesc(ConversationEntity::getLastMessageTime);
        
        Page<ConversationEntity> pageObj = new Page<>(page, pageSize);
        Page<ConversationEntity> result = conversationsMapper.selectPage(pageObj, wrapper);
        
        return PageResult.of(result);
    }
    
    @Override
    public UnreadCounts getUnreadCounts() {
        UnreadCounts counts = new UnreadCounts();
        
        // ä½¿ç”¨QueryWrapperç»Ÿè®¡æœªè¯»æ¶ˆæ¯
        LambdaQueryWrapper<ConversationEntity> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(ConversationEntity::getIsRead, false);
        
        Long unreadConversations = conversationsMapper.selectCount(wrapper);
        counts.setConversations(unreadConversations.intValue());
        
        // ç»Ÿè®¡å…¶ä»–ç±»å‹æœªè¯»æ¶ˆæ¯...
        
        return counts;
    }
    
    @Override
    public PageResult<MessageEntity> getChatMessages(Long conversationId, Integer page, Integer pageSize) {
        LambdaQueryWrapper<MessageEntity> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(MessageEntity::getReceiverId, conversationId)
               .or()
               .eq(MessageEntity::getSenderId, conversationId)
               .orderByDesc(MessageEntity::getCreatedAt);
        
        Page<MessageEntity> pageObj = new Page<>(page, pageSize);
        Page<MessageEntity> result = messagesMapper.selectPage(pageObj, wrapper);
        
        return PageResult.of(result);
    }
    
    @Override
    public MessageEntity sendMessage(Long conversationId, MessageCreateDTO dto) {
        MessageEntity message = new MessageEntity();
        message.setReceiverId(dto.getReceiverId());
        message.setContent(dto.getContent());
        message.setContentType(dto.getContentType());
        message.setStatus("sent");
        message.setIsRead(false);
        
        messagesMapper.insert(message);
        
        // æ›´æ–°å¯¹è¯æœ€åæ¶ˆæ¯
        updateConversationLastMessage(conversationId, message);
        
        return message;
    }
    
    @Override
    public void markRead(Long id) {
        LambdaQueryWrapper<MessageEntity> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(MessageEntity::getId, id);
        
        MessageEntity message = new MessageEntity();
        message.setIsRead(true);
        
        messagesMapper.update(message, wrapper);
    }
    
    @Override
    public void deleteMessage(Long id) {
        messagesMapper.deleteById(id);
    }
    
    @Override
    public void clearAll(String type) {
        LambdaQueryWrapper<MessageEntity> wrapper = new LambdaQueryWrapper<>();
        wrapper.eq(MessageEntity::getType, type);
        
        messagesMapper.delete(wrapper);
    }
    
    private void updateConversationLastMessage(Long conversationId, MessageEntity message) {
        // æ›´æ–°å¯¹è¯æœ€åæ¶ˆæ¯é€»è¾‘
    }
}
```

### 5.7 Mapperæ¥å£ï¼ˆmapperMessages.javaï¼‰

```java
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import org.apache.ibatis.annotations.Mapper;

@Mapper
public interface MessagesMapper extends BaseMapper<MessageEntity> {
    // ç»§æ‰¿BaseMapperï¼Œåˆ©ç”¨MyBatis-Pluså†…ç½®æ–¹æ³•
}

@Mapper
public interface ConversationsMapper extends BaseMapper<ConversationEntity> {
    // ç»§æ‰¿BaseMapperï¼Œåˆ©ç”¨MyBatis-Pluså†…ç½®æ–¹æ³•
}

@Mapper
public interface NotificationsMapper extends BaseMapper<NotificationEntity> {
    // ç»§æ‰¿BaseMapperï¼Œåˆ©ç”¨MyBatis-Pluså†…ç½®æ–¹æ³•
}
```

---

## ğŸ“ å…­ã€å…«æ®µå¼ä»£ç ç»“æ„è§„èŒƒ

### 6.1 MainPageä¸»æ–‡ä»¶ç»“æ„ï¼ˆindex.tsxï¼‰

```typescript
// #region 1. File Banner & TOC
/**
 * MainPage - æ¶ˆæ¯æ¨¡å—ä¸»é¡µé¢
 * 
 * åŠŸèƒ½æè¿°ï¼šæ¶ˆæ¯ä¸»é¡µé¢ï¼ŒåŒ…å«4å®«æ ¼åˆ†ç±»ã€å¯¹è¯åˆ—è¡¨ã€å¯¼èˆªæ 
 * 
 * TOC (å¿«é€Ÿè·³è½¬):
 * [1] Imports
 * [2] Types & Schema
 * [3] Constants & Config
 * [4] Utils & Helpers
 * [5] State Management
 * [6] Domain Logic
 * [7] UI Components & Rendering
 * [8] Exports
 */
// #endregion

// #region 2. Imports
import React, { useState, useEffect, useCallback, useMemo } from 'react';
import { View, ScrollView, RefreshControl, StyleSheet } from 'react-native';
import { useRouter } from 'expo-router';

// å†…éƒ¨ç»„ä»¶å¯¼å…¥
import { NavigationArea } from './NavigationArea';
import { CategoryArea } from './CategoryArea';
import { ConversationArea } from './ConversationArea';

// APIå’ŒStoreå¯¼å…¥
import { getConversationList, getUnreadCounts } from '../../api/apiMessagesMain';

// ç±»å‹å’Œå¸¸é‡å¯¼å…¥
import type { MainPageProps, Conversation, UnreadCounts } from './types';
import { MESSAGES_CONFIG, ANIMATION_DURATION } from './constants';
// #endregion

// #region 3. Types & Schema
// æœ¬åœ°çŠ¶æ€ç±»å‹
interface MainPageState {
  conversations: Conversation[];
  unreadCounts: UnreadCounts;
  isLoading: boolean;
  isRefreshing: boolean;
  error: Error | null;
}
// #endregion

// #region 4. Constants & Config
// æœ¬åœ°å¸¸é‡
const REFRESH_THRESHOLD = 80;
const LOAD_MORE_THRESHOLD = 0.8;
// #endregion

// #region 5. Utils & Helpers
// ğŸ¯ æœ¬åœ°å·¥å…·å‡½æ•°ï¼ˆé›†ä¸­ç®¡ç†ï¼Œé¿å…åˆ›å»ºç‹¬ç«‹æ–‡ä»¶ï¼‰

/**
 * æ ¼å¼åŒ–æ—¶é—´æ˜¾ç¤º
 */
const formatTime = (timestamp: number): string => {
  const now = Date.now();
  const diff = now - timestamp;
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);
  
  if (minutes < 1) return MESSAGES_CONFIG.TIME_FORMAT.JUST_NOW;
  if (minutes < 60) return MESSAGES_CONFIG.TIME_FORMAT.MINUTES_AGO(minutes);
  if (hours < 24) return MESSAGES_CONFIG.TIME_FORMAT.HOURS_AGO(hours);
  if (days === 1) return MESSAGES_CONFIG.TIME_FORMAT.YESTERDAY;
  
  const date = new Date(timestamp);
  return `${date.getMonth() + 1}-${date.getDate()}`;
};

/**
 * æ ¼å¼åŒ–æœªè¯»æ•°é‡æ˜¾ç¤º
 */
const formatUnreadCount = (count: number): string => {
  if (count === 0) return '';
  if (count > MESSAGES_CONFIG.UNREAD_COUNT_MAX) {
    return MESSAGES_CONFIG.UNREAD_COUNT_OVERFLOW;
  }
  return count.toString();
};

/**
 * æˆªæ–­æ¶ˆæ¯é¢„è§ˆ
 */
const truncateMessage = (message: string, maxLength: number = MESSAGES_CONFIG.MESSAGE_PREVIEW_LENGTH): string => {
  if (message.length <= maxLength) return message;
  return message.substring(0, maxLength) + '...';
};
// #endregion

// #region 6. State Management
// ğŸ¯ çŠ¶æ€ç®¡ç†Hookï¼ˆé›†ä¸­ç®¡ç†ï¼Œé¿å…åˆ›å»ºç‹¬ç«‹hooksæ–‡ä»¶ï¼‰

/**
 * ä¸»é¡µé¢çŠ¶æ€ç®¡ç†Hook
 */
const useMainPageState = () => {
  const [conversations, setConversations] = useState<Conversation[]>([]);
  const [unreadCounts, setUnreadCounts] = useState<UnreadCounts>({
    likes: 0,
    comments: 0,
    followers: 0,
    notifications: 0,
    conversations: 0,
    total: 0,
  });
  const [isLoading, setIsLoading] = useState(false);
  const [isRefreshing, setIsRefreshing] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);
  
  // è®¡ç®—æ€»æœªè¯»æ•°
  const totalUnread = useMemo(() => {
    return unreadCounts.total;
  }, [unreadCounts]);
  
  return {
    conversations,
    setConversations,
    unreadCounts,
    setUnreadCounts,
    isLoading,
    setIsLoading,
    isRefreshing,
    setIsRefreshing,
    error,
    setError,
    page,
    setPage,
    hasMore,
    setHasMore,
    totalUnread,
  };
};

/**
 * æ•°æ®åŠ è½½Hook
 */
const useDataLoading = (state: ReturnType<typeof useMainPageState>) => {
  // åŠ è½½å¯¹è¯åˆ—è¡¨
  const loadConversations = useCallback(async (isRefresh = false) => {
    if (state.isLoading) return;
    
    try {
      if (isRefresh) {
        state.setIsRefreshing(true);
        state.setPage(1);
      } else {
        state.setIsLoading(true);
      }
      
      const currentPage = isRefresh ? 1 : state.page;
      const response = await getConversationList({
        page: currentPage,
        pageSize: MESSAGES_CONFIG.PAGE_SIZE,
      });
      
      if (response.code === 200) {
        const newData = response.data.list;
        if (isRefresh) {
          state.setConversations(newData);
        } else {
          state.setConversations([...state.conversations, ...newData]);
        }
        
        state.setHasMore(response.data.hasMore);
        state.setPage(currentPage + 1);
      }
    } catch (err) {
      state.setError(err as Error);
      console.error('åŠ è½½å¯¹è¯åˆ—è¡¨å¤±è´¥:', err);
    } finally {
      state.setIsLoading(false);
      state.setIsRefreshing(false);
    }
  }, [state]);
  
  // åŠ è½½æœªè¯»æ•°é‡
  const loadUnreadCounts = useCallback(async () => {
    try {
      const response = await getUnreadCounts();
      if (response.code === 200) {
        state.setUnreadCounts(response.data);
      }
    } catch (err) {
      console.error('åŠ è½½æœªè¯»æ•°é‡å¤±è´¥:', err);
    }
  }, [state]);
  
  // åˆå§‹åŒ–æ•°æ®
  useEffect(() => {
    loadConversations(true);
    loadUnreadCounts();
  }, []);
  
  // è‡ªåŠ¨åˆ·æ–°æœªè¯»æ•°é‡
  useEffect(() => {
    const interval = setInterval(() => {
      loadUnreadCounts();
    }, MESSAGES_CONFIG.AUTO_REFRESH_INTERVAL);
    
    return () => clearInterval(interval);
  }, [loadUnreadCounts]);
  
  return {
    loadConversations,
    loadUnreadCounts,
  };
};
// #endregion

// #region 7. Domain Logic
// ğŸ¯ äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆé›†ä¸­ç®¡ç†ï¼Œé¿å…åˆ›å»ºç‹¬ç«‹æ–‡ä»¶ï¼‰

/**
 * ä¸šåŠ¡é€»è¾‘Hook
 */
const useMainPageLogic = (
  state: ReturnType<typeof useMainPageState>,
  loader: ReturnType<typeof useDataLoading>
) => {
  const router = useRouter();
  
  // åˆ†ç±»ç‚¹å‡»å¤„ç†
  const handleCategoryPress = useCallback((category: string) => {
    router.push(`/messages/${category}`);
  }, [router]);
  
  // å¯¹è¯ç‚¹å‡»å¤„ç†
  const handleConversationPress = useCallback((conversationId: string) => {
    router.push(`/messages/chat/${conversationId}`);
  }, [router]);
  
  // å¯¹è¯åˆ é™¤å¤„ç†
  const handleConversationDelete = useCallback((conversationId: string) => {
    // æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
    // è°ƒç”¨åˆ é™¤API
    // æ›´æ–°åˆ—è¡¨
  }, []);
  
  // ä¸‹æ‹‰åˆ·æ–°å¤„ç†
  const handleRefresh = useCallback(() => {
    loader.loadConversations(true);
    loader.loadUnreadCounts();
  }, [loader]);
  
  // åŠ è½½æ›´å¤šå¤„ç†
  const handleLoadMore = useCallback(() => {
    if (!state.isLoading && state.hasMore) {
      loader.loadConversations(false);
    }
  }, [state.isLoading, state.hasMore, loader]);
  
  return {
    handleCategoryPress,
    handleConversationPress,
    handleConversationDelete,
    handleRefresh,
    handleLoadMore,
  };
};
// #endregion

// #region 8. UI Components & Rendering
/**
 * ä¸»é¡µé¢ç»„ä»¶
 */
const MainPage: React.FC<MainPageProps> = (props) => {
  const state = useMainPageState();
  const loader = useDataLoading(state);
  const logic = useMainPageLogic(state, loader);
  
  return (
    <View style={styles.container}>
      {/* å¯¼èˆªæ  */}
      <NavigationArea />
      
      {/* ä¸»å†…å®¹åŒº */}
      <ScrollView
        style={styles.scrollView}
        refreshControl={
          <RefreshControl
            refreshing={state.isRefreshing}
            onRefresh={logic.handleRefresh}
          />
        }
        onScroll={({ nativeEvent }) => {
          const { layoutMeasurement, contentOffset, contentSize } = nativeEvent;
          const isCloseToBottom =
            layoutMeasurement.height + contentOffset.y >= contentSize.height * LOAD_MORE_THRESHOLD;
          
          if (isCloseToBottom) {
            logic.handleLoadMore();
          }
        }}
        scrollEventThrottle={16}
      >
        {/* 4å®«æ ¼åˆ†ç±»åŒºåŸŸ */}
        <CategoryArea
          unreadCounts={state.unreadCounts}
          onCategoryPress={logic.handleCategoryPress}
        />
        
        {/* å¯¹è¯åˆ—è¡¨åŒºåŸŸ */}
        <ConversationArea
          conversations={state.conversations}
          onConversationPress={logic.handleConversationPress}
          onConversationDelete={logic.handleConversationDelete}
          isLoading={state.isLoading}
        />
      </ScrollView>
    </View>
  );
};

// æ ·å¼å®šä¹‰
const styles = StyleSheet.create({
  container: {
    flex: 1,
    backgroundColor: '#FFFFFF',
  },
  scrollView: {
    flex: 1,
  },
});
// #endregion

// #region 9. Exports
export default MainPage;
export type { MainPageProps };
// #endregion
```

### 6.2 CategoryAreaåŒºåŸŸç»„ä»¶ç»“æ„

```typescript
// #region 1. File Banner & TOC
/**
 * CategoryArea - 4å®«æ ¼åˆ†ç±»åŒºåŸŸç»„ä»¶
 * 
 * åŠŸèƒ½æè¿°ï¼šæ¶ˆæ¯åˆ†ç±»å…¥å£ï¼Œå±•ç¤º4ä¸ªåˆ†ç±»å¡ç‰‡å’Œæœªè¯»è§’æ ‡
 * 
 * TOC (å¿«é€Ÿè·³è½¬):
 * [1] Imports
 * [2] Types & Schema
 * [3] Constants & Config
 * [4] Utils & Helpers
 * [5] State Management
 * [6] Domain Logic
 * [7] UI Components & Rendering
 * [8] Exports
 */
// #endregion

// #region 2. Imports
import React, { useCallback } from 'react';
import { View, Text, TouchableOpacity, StyleSheet } from 'react-native';
import { LinearGradient } from 'expo-linear-gradient';

import type { CategoryAreaProps } from './types';
import { CATEGORIES, UI_SIZES, COLORS, ANIMATION_DURATION } from './constants';
// #endregion

// #region 3. Types & Schema
interface CategoryCardProps {
  id: string;
  title: string;
  icon: string;
  color: string;
  unreadCount: number;
  onPress: () => void;
}
// #endregion

// #region 4. Constants & Config
const CARD_SIZE = UI_SIZES.CATEGORY_CARD_SIZE;
const ICON_SIZE = UI_SIZES.CATEGORY_ICON_SIZE;
// #endregion

// #region 5. Utils & Helpers
// ğŸ¯ æœ¬åœ°å·¥å…·å‡½æ•°

/**
 * æ ¼å¼åŒ–æœªè¯»æ•°é‡
 */
const formatUnreadCount = (count: number): string => {
  if (count === 0) return '';
  if (count > 99) return '99+';
  return count.toString();
};
// #endregion

// #region 6. State Management
// æ— éœ€çŠ¶æ€ç®¡ç†ï¼ˆçº¯å±•ç¤ºç»„ä»¶ï¼‰
// #endregion

// #region 7. Domain Logic
// ğŸ¯ äº‹ä»¶å¤„ç†å‡½æ•°

/**
 * åˆ†ç±»å¡ç‰‡ç‚¹å‡»å¤„ç†
 */
const handleCategoryPress = (
  categoryId: string,
  onPress: (category: string) => void
) => {
  // è§¦è§‰åé¦ˆï¼ˆç§»åŠ¨ç«¯ï¼‰
  // Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
  
  onPress(categoryId);
};
// #endregion

// #region 8. UI Components & Rendering
/**
 * åˆ†ç±»å¡ç‰‡ç»„ä»¶
 */
const CategoryCard: React.FC<CategoryCardProps> = ({
  id,
  title,
  icon,
  color,
  unreadCount,
  onPress,
}) => {
  const handlePress = useCallback(() => {
    handleCategoryPress(id, onPress);
  }, [id, onPress]);
  
  return (
    <TouchableOpacity
      style={styles.card}
      onPress={handlePress}
      activeOpacity={0.7}
    >
      <LinearGradient
        colors={[color, color + 'CC']}
        style={styles.iconContainer}
      >
        {/* å›¾æ ‡ */}
        <Text style={styles.iconText}>{icon}</Text>
        
        {/* æœªè¯»è§’æ ‡ */}
        {unreadCount > 0 && (
          <View style={styles.badge}>
            <Text style={styles.badgeText}>
              {formatUnreadCount(unreadCount)}
            </Text>
          </View>
        )}
      </LinearGradient>
      
      <Text style={styles.title}>{title}</Text>
    </TouchableOpacity>
  );
};

/**
 * åˆ†ç±»åŒºåŸŸç»„ä»¶
 */
const CategoryArea: React.FC<CategoryAreaProps> = ({
  unreadCounts,
  onCategoryPress,
  style,
}) => {
  return (
    <View style={[styles.container, style]}>
      <View style={styles.grid}>
        {CATEGORIES.map((category) => (
          <CategoryCard
            key={category.id}
            id={category.id}
            title={category.title}
            icon={category.icon}
            color={category.color}
            unreadCount={unreadCounts[category.id as keyof typeof unreadCounts] || 0}
            onPress={onCategoryPress}
          />
        ))}
      </View>
    </View>
  );
};

// æ ·å¼å®šä¹‰
const styles = StyleSheet.create({
  container: {
    paddingVertical: 16,
    paddingHorizontal: 16,
    backgroundColor: '#FFFFFF',
  },
  grid: {
    flexDirection: 'row',
    flexWrap: 'wrap',
    justifyContent: 'space-between',
  },
  card: {
    width: (CARD_SIZE + 16) * 2,
    marginBottom: 16,
    alignItems: 'center',
  },
  iconContainer: {
    width: CARD_SIZE,
    height: CARD_SIZE,
    borderRadius: 12,
    justifyContent: 'center',
    alignItems: 'center',
    position: 'relative',
  },
  iconText: {
    fontSize: ICON_SIZE,
  },
  badge: {
    position: 'absolute',
    top: -4,
    right: -4,
    backgroundColor: COLORS.UNREAD,
    borderRadius: 10,
    minWidth: 20,
    height: 20,
    justifyContent: 'center',
    alignItems: 'center',
    paddingHorizontal: 6,
  },
  badgeText: {
    color: '#FFFFFF',
    fontSize: 12,
    fontWeight: 'bold',
  },
  title: {
    marginTop: 8,
    fontSize: 14,
    color: COLORS.TEXT_PRIMARY,
  },
});
// #endregion

// #region 9. Exports
export default CategoryArea;
export { CategoryCard };
export type { CategoryAreaProps, CategoryCardProps };
// #endregion
```

---

## ğŸ”„ ä¸ƒã€çŠ¶æ€ç®¡ç†ç­–ç•¥

### 7.1 ä¸»æ–‡ä»¶é›†ä¸­ç®¡ç†ï¼ˆæ¨èï¼‰

æ¶ˆæ¯æ¨¡å—çš„çŠ¶æ€ç®¡ç†é‡‡ç”¨ **ä¸»æ–‡ä»¶é›†ä¸­ç®¡ç†** ç­–ç•¥ï¼Œæ‰€æœ‰ç®€å•å’Œä¸­ç­‰å¤æ‚åº¦çš„çŠ¶æ€éƒ½åœ¨ä¸»æ–‡ä»¶å†…ç®¡ç†ã€‚

```typescript
// âœ… æ­£ç¡®åšæ³•ï¼šåœ¨ä¸»æ–‡ä»¶å†…ç›´æ¥ç®¡ç†æ‰€æœ‰çŠ¶æ€

// #region 6. State Management
const useMainPageState = () => {
  // æ•°æ®çŠ¶æ€
  const [conversations, setConversations] = useState<Conversation[]>([]);
  const [unreadCounts, setUnreadCounts] = useState<UnreadCounts>({...});
  
  // UIçŠ¶æ€
  const [isLoading, setIsLoading] = useState(false);
  const [isRefreshing, setIsRefreshing] = useState(false);
  const [error, setError] = useState<Error | null>(null);
  
  // åˆ†é¡µçŠ¶æ€
  const [page, setPage] = useState(1);
  const [hasMore, setHasMore] = useState(true);
  
  // è®¡ç®—å±æ€§
  const totalUnread = useMemo(() => {
    return Object.values(unreadCounts).reduce((sum, count) => sum + count, 0);
  }, [unreadCounts]);
  
  return {
    conversations,
    setConversations,
    unreadCounts,
    setUnreadCounts,
    isLoading,
    setIsLoading,
    isRefreshing,
    setIsRefreshing,
    error,
    setError,
    page,
    setPage,
    hasMore,
    setHasMore,
    totalUnread,
  };
};
// #endregion
```

### 7.2 WebSocketå®æ—¶çŠ¶æ€ï¼ˆå¤æ‚é€»è¾‘é€‚åº¦æŠ½ç¦»ï¼‰

å¯¹äºWebSocketè¿™ç§å¤æ‚çš„å®æ—¶é€šä¿¡é€»è¾‘ï¼Œå¯ä»¥é€‚åº¦æŠ½ç¦»ä¸ºç‹¬ç«‹Hookï¼š

```typescript
// useWebSocket.ts - å¤æ‚WebSocketé€»è¾‘æŠ½ç¦»

/**
 * WebSocketè¿æ¥ç®¡ç†Hook
 * 
 * åˆ›å»ºåŸå› ï¼š
 * - æ¶‰åŠå¤æ‚çš„è¿æ¥çŠ¶æ€ç®¡ç†
 * - éœ€è¦å¤„ç†æ–­çº¿é‡è¿é€»è¾‘
 * - å¤šä¸ªé¡µé¢éœ€è¦å…±äº«WebSocketè¿æ¥
 */
export function useWebSocket() {
  const [isConnected, setIsConnected] = useState(false);
  const [reconnectCount, setReconnectCount] = useState(0);
  const wsRef = useRef<WebSocket | null>(null);
  
  // è¿æ¥WebSocket
  const connect = useCallback(() => {
    if (wsRef.current) return;
    
    const ws = new WebSocket(WS_URL);
    
    ws.onopen = () => {
      setIsConnected(true);
      setReconnectCount(0);
    };
    
    ws.onclose = () => {
      setIsConnected(false);
      handleReconnect();
    };
    
    ws.onerror = (error) => {
      console.error('WebSocket error:', error);
    };
    
    ws.onmessage = (event) => {
      handleMessage(JSON.parse(event.data));
    };
    
    wsRef.current = ws;
  }, []);
  
  // æ–­çº¿é‡è¿
  const handleReconnect = useCallback(() => {
    if (reconnectCount >= MAX_RECONNECT_ATTEMPTS) {
      return;
    }
    
    setTimeout(() => {
      setReconnectCount(reconnectCount + 1);
      connect();
    }, RECONNECT_INTERVAL);
  }, [reconnectCount, connect]);
  
  // å‘é€æ¶ˆæ¯
  const sendMessage = useCallback((message: any) => {
    if (wsRef.current && isConnected) {
      wsRef.current.send(JSON.stringify(message));
    }
  }, [isConnected]);
  
  // æ–­å¼€è¿æ¥
  const disconnect = useCallback(() => {
    if (wsRef.current) {
      wsRef.current.close();
      wsRef.current = null;
    }
  }, []);
  
  useEffect(() => {
    connect();
    return () => disconnect();
  }, []);
  
  return {
    isConnected,
    sendMessage,
    disconnect,
  };
}
```

---

## ğŸš¨ å…«ã€é”™è¯¯å¤„ç†ä¸è¾¹ç•Œæƒ…å†µ

### 8.1 APIé”™è¯¯å¤„ç†

```typescript
/**
 * ç»Ÿä¸€APIé”™è¯¯å¤„ç†å‡½æ•°
 */
const handleApiError = (error: any): string => {
  if (error.code) {
    switch (error.code) {
      case 401:
        // æœªæˆæƒï¼šè·³è½¬ç™»å½•é¡µ
        return 'è¯·å…ˆç™»å½•';
      case 403:
        // æƒé™ä¸è¶³
        return 'æƒé™ä¸è¶³ï¼Œæ— æ³•æ‰§è¡Œè¯¥æ“ä½œ';
      case 404:
        // èµ„æºä¸å­˜åœ¨
        return 'å†…å®¹ä¸å­˜åœ¨æˆ–å·²è¢«åˆ é™¤';
      case 429:
        // è¯·æ±‚é¢‘ç¹
        return 'æ“ä½œè¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•';
      case 500:
        // æœåŠ¡å™¨é”™è¯¯
        return 'æœåŠ¡å™¨å¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•';
      default:
        return 'æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•';
    }
  }
  
  if (error.message) {
    return error.message;
  }
  
  return 'æœªçŸ¥é”™è¯¯';
};

/**
 * ä½¿ç”¨ç¤ºä¾‹
 */
try {
  const response = await getConversationList({ page: 1, pageSize: 20 });
  if (response.code === 200) {
    setConversations(response.data.list);
  } else {
    const errorMessage = handleApiError(response);
    showToast(errorMessage);
  }
} catch (error) {
  const errorMessage = handleApiError(error);
  showToast(errorMessage);
}
```

### 8.2 ç©ºçŠ¶æ€å¤„ç†

```typescript
/**
 * ç©ºçŠ¶æ€ç»„ä»¶
 */
const EmptyState: React.FC<{
  type: 'conversations' | 'likes' | 'comments' | 'followers' | 'notifications';
}> = ({ type }) => {
  const emptyMessages = {
    conversations: {
      icon: 'ğŸ’¬',
      title: 'æš‚æ— å¯¹è¯',
      subtitle: 'å¼€å§‹å’Œå…¶ä»–ç”¨æˆ·èŠå¤©å§',
    },
    likes: {
      icon: 'ğŸ’–',
      title: 'æš‚æ— ç‚¹èµå’Œæ”¶è—',
      subtitle: 'å‘å¸ƒä¼˜è´¨å†…å®¹è·å¾—æ›´å¤šäº’åŠ¨',
    },
    comments: {
      icon: 'ğŸ’¬',
      title: 'æš‚æ— è¯„è®º',
      subtitle: 'å¿«å»è¯„è®ºåˆ«äººçš„ä½œå“å§',
    },
    followers: {
      icon: 'ğŸ‘¥',
      title: 'æš‚æ— æ–°å¢ç²‰ä¸',
      subtitle: 'æå‡å†…å®¹è´¨é‡å¸å¼•æ›´å¤šå…³æ³¨',
    },
    notifications: {
      icon: 'ğŸ””',
      title: 'æš‚æ— ç³»ç»Ÿé€šçŸ¥',
      subtitle: 'æœ‰æ–°é€šçŸ¥ä¼šç¬¬ä¸€æ—¶é—´å‘ŠçŸ¥æ‚¨',
    },
  };
  
  const message = emptyMessages[type];
  
  return (
    <View style={styles.emptyContainer}>
      <Text style={styles.emptyIcon}>{message.icon}</Text>
      <Text style={styles.emptyTitle}>{message.title}</Text>
      <Text style={styles.emptySubtitle}>{message.subtitle}</Text>
    </View>
  );
};
```

### 8.3 åŠ è½½çŠ¶æ€å¤„ç†

```typescript
/**
 * åŠ è½½çŠ¶æ€ç»„ä»¶
 */
const LoadingState: React.FC = () => (
  <View style={styles.loadingContainer}>
    <ActivityIndicator size="large" color={COLORS.PRIMARY} />
    <Text style={styles.loadingText}>åŠ è½½ä¸­...</Text>
  </View>
);

/**
 * é”™è¯¯çŠ¶æ€ç»„ä»¶
 */
const ErrorState: React.FC<{
  error: Error;
  onRetry: () => void;
}> = ({ error, onRetry }) => (
  <View style={styles.errorContainer}>
    <Text style={styles.errorIcon}>âš ï¸</Text>
    <Text style={styles.errorTitle}>åŠ è½½å¤±è´¥</Text>
    <Text style={styles.errorMessage}>{error.message}</Text>
    <TouchableOpacity style={styles.retryButton} onPress={onRetry}>
      <Text style={styles.retryButtonText}>é‡è¯•</Text>
    </TouchableOpacity>
  </View>
);
```

### 8.4 ç½‘ç»œçŠ¶æ€å¤„ç†

```typescript
/**
 * ç½‘ç»œçŠ¶æ€ç›‘å¬Hook
 */
const useNetworkStatus = () => {
  const [isOnline, setIsOnline] = useState(true);
  
  useEffect(() => {
    // ç›‘å¬ç½‘ç»œçŠ¶æ€
    const unsubscribe = NetInfo.addEventListener(state => {
      setIsOnline(state.isConnected ?? false);
      
      if (!state.isConnected) {
        showToast('ç½‘ç»œè¿æ¥å·²æ–­å¼€');
      } else {
        showToast('ç½‘ç»œå·²æ¢å¤');
        // é‡æ–°åŠ è½½æ•°æ®
      }
    });
    
    return () => unsubscribe();
  }, []);
  
  return { isOnline };
};
```

---

## âš¡ ä¹ã€æ€§èƒ½ä¼˜åŒ–å®æ–½æ–¹æ¡ˆ

### 9.1 åˆ—è¡¨è™šæ‹ŸåŒ–

```typescript
import { FlatList } from 'react-native';

/**
 * ä½¿ç”¨FlatListå®ç°è™šæ‹ŸåŒ–åˆ—è¡¨
 */
const ConversationList: React.FC<{
  data: Conversation[];
  onItemPress: (id: string) => void;
}> = ({ data, onItemPress }) => {
  // æ¸²æŸ“å•ä¸ªåˆ—è¡¨é¡¹
  const renderItem = useCallback(({ item }: { item: Conversation }) => (
    <MessageItem
      id={item.id}
      type="conversation"
      avatar={item.userAvatar}
      title={item.userName}
      subtitle={item.lastMessage}
      timestamp={item.lastMessageTime}
      isRead={item.isRead}
      unreadCount={item.unreadCount}
      onPress={() => onItemPress(item.id)}
    />
  ), [onItemPress]);
  
  // æå–key
  const keyExtractor = useCallback((item: Conversation) => item.id, []);
  
  // è·å–å¸ƒå±€ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
  const getItemLayout = useCallback(
    (data, index) => ({
      length: UI_SIZES.MESSAGE_ITEM_HEIGHT,
      offset: UI_SIZES.MESSAGE_ITEM_HEIGHT * index,
      index,
    }),
    []
  );
  
  return (
    <FlatList
      data={data}
      renderItem={renderItem}
      keyExtractor={keyExtractor}
      getItemLayout={getItemLayout}
      initialNumToRender={10}
      maxToRenderPerBatch={10}
      windowSize={5}
      removeClippedSubviews={true}
    />
  );
};
```

### 9.2 å›¾ç‰‡æ‡’åŠ è½½

```typescript
import FastImage from 'react-native-fast-image';

/**
 * ä¼˜åŒ–çš„å›¾ç‰‡ç»„ä»¶
 */
const OptimizedImage: React.FC<{
  uri: string;
  size: number;
  style?: any;
}> = ({ uri, size, style }) => (
  <FastImage
    source={{
      uri,
      priority: FastImage.priority.normal,
      cache: FastImage.cacheControl.immutable,
    }}
    style={[{ width: size, height: size }, style]}
    resizeMode={FastImage.resizeMode.cover}
  />
);
```

### 9.3 é˜²æŠ–èŠ‚æµ

```typescript
import { useMemo } from 'react';
import { debounce, throttle } from 'lodash';

/**
 * æœç´¢è¾“å…¥é˜²æŠ–
 */
const useSearchDebounce = (callback: (keyword: string) => void, delay = 300) => {
  return useMemo(
    () => debounce(callback, delay),
    [callback, delay]
  );
};

/**
 * æ»šåŠ¨äº‹ä»¶èŠ‚æµ
 */
const useScrollThrottle = (callback: () => void, delay = 100) => {
  return useMemo(
    () => throttle(callback, delay),
    [callback, delay]
  );
};
```

### 9.4 æ•°æ®ç¼“å­˜

```typescript
import AsyncStorage from '@react-native-async-storage/async-storage';

/**
 * å¯¹è¯åˆ—è¡¨ç¼“å­˜
 */
const CACHE_KEY = 'MESSAGES_CONVERSATIONS_CACHE';

/**
 * ä¿å­˜ç¼“å­˜
 */
const saveCache = async (data: Conversation[]) => {
  try {
    await AsyncStorage.setItem(CACHE_KEY, JSON.stringify(data));
  } catch (error) {
    console.error('ä¿å­˜ç¼“å­˜å¤±è´¥:', error);
  }
};

/**
 * è¯»å–ç¼“å­˜
 */
const loadCache = async (): Promise<Conversation[]> => {
  try {
    const data = await AsyncStorage.getItem(CACHE_KEY);
    return data ? JSON.parse(data) : [];
  } catch (error) {
    console.error('è¯»å–ç¼“å­˜å¤±è´¥:', error);
    return [];
  }
};

/**
 * æ¸…é™¤ç¼“å­˜
 */
const clearCache = async () => {
  try {
    await AsyncStorage.removeItem(CACHE_KEY);
  } catch (error) {
    console.error('æ¸…é™¤ç¼“å­˜å¤±è´¥:', error);
  }
};
```

---

## ğŸ“± åã€ç§»åŠ¨ç«¯ç‰¹æ€§é€‚é…

### 10.1 æ‰‹åŠ¿äº¤äº’

```typescript
import { GestureDetector, Gesture } from 'react-native-gesture-handler';
import Animated, {
  useSharedValue,
  useAnimatedStyle,
  withTiming,
  runOnJS,
} from 'react-native-reanimated';

/**
 * æ»‘åŠ¨åˆ é™¤ç»„ä»¶
 */
const SwipeableItem: React.FC<{
  children: React.ReactNode;
  onDelete: () => void;
}> = ({ children, onDelete }) => {
  const translateX = useSharedValue(0);
  
  const panGesture = Gesture.Pan()
    .onUpdate((event) => {
      // åªå…è®¸å‘å·¦æ»‘åŠ¨
      if (event.translationX < 0) {
        translateX.value = event.translationX;
      }
    })
    .onEnd((event) => {
      // æ»‘åŠ¨è¶…è¿‡é˜ˆå€¼è§¦å‘åˆ é™¤
      if (event.translationX < -100) {
        translateX.value = withTiming(-200, { duration: 200 });
        runOnJS(onDelete)();
      } else {
        // å›å¼¹
        translateX.value = withTiming(0, { duration: 200 });
      }
    });
  
  const animatedStyle = useAnimatedStyle(() => ({
    transform: [{ translateX: translateX.value }],
  }));
  
  return (
    <GestureDetector gesture={panGesture}>
      <Animated.View style={animatedStyle}>
        {children}
      </Animated.View>
    </GestureDetector>
  );
};
```

### 10.2 è§¦è§‰åé¦ˆ

```typescript
import * as Haptics from 'expo-haptics';

/**
 * è§¦è§‰åé¦ˆå·¥å…·å‡½æ•°
 */
const hapticFeedback = {
  // è½»è§¦åé¦ˆ
  light: () => {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Light);
  },
  
  // ä¸­ç­‰åé¦ˆ
  medium: () => {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Medium);
  },
  
  // é‡è§¦åé¦ˆ
  heavy: () => {
    Haptics.impactAsync(Haptics.ImpactFeedbackStyle.Heavy);
  },
  
  // æˆåŠŸåé¦ˆ
  success: () => {
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Success);
  },
  
  // è­¦å‘Šåé¦ˆ
  warning: () => {
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Warning);
  },
  
  // é”™è¯¯åé¦ˆ
  error: () => {
    Haptics.notificationAsync(Haptics.NotificationFeedbackType.Error);
  },
};

/**
 * ä½¿ç”¨ç¤ºä¾‹
 */
const handleButtonPress = () => {
  hapticFeedback.light();
  // æ‰§è¡ŒæŒ‰é’®æ“ä½œ
};
```

### 10.3 å®‰å…¨åŒºåŸŸé€‚é…

```typescript
import { useSafeAreaInsets } from 'react-native-safe-area-context';

/**
 * å®‰å…¨åŒºåŸŸé€‚é…Hook
 */
const useMessagesLayout = () => {
  const insets = useSafeAreaInsets();
  
  return {
    // é¡¶éƒ¨å®‰å…¨åŒºåŸŸ
    paddingTop: insets.top,
    
    // åº•éƒ¨å®‰å…¨åŒºåŸŸ
    paddingBottom: insets.bottom,
    
    // å¯¼èˆªæ æ€»é«˜åº¦ï¼ˆå«å®‰å…¨åŒºåŸŸï¼‰
    navigationHeight: UI_SIZES.NAVIGATION_BAR_HEIGHT + insets.top,
    
    // åº•éƒ¨Tabæ æ€»é«˜åº¦ï¼ˆå«å®‰å…¨åŒºåŸŸï¼‰
    tabBarHeight: UI_SIZES.BOTTOM_TAB_BAR_HEIGHT + insets.bottom,
  };
};

/**
 * ä½¿ç”¨ç¤ºä¾‹
 */
const MainPage: React.FC = () => {
  const layout = useMessagesLayout();
  
  return (
    <View style={{ flex: 1 }}>
      <View style={{ height: layout.navigationHeight, paddingTop: layout.paddingTop }}>
        {/* å¯¼èˆªæ å†…å®¹ */}
      </View>
      
      <View style={{ flex: 1 }}>
        {/* ä¸»å†…å®¹ */}
      </View>
    </View>
  );
};
```

### 10.4 é”®ç›˜å¤„ç†

```typescript
import { KeyboardAvoidingView, Platform } from 'react-native';

/**
 * é”®ç›˜é¿è®©ç»„ä»¶
 */
const ChatPage: React.FC = () => {
  return (
    <KeyboardAvoidingView
      style={{ flex: 1 }}
      behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
      keyboardVerticalOffset={Platform.OS === 'ios' ? 64 : 0}
    >
      {/* èŠå¤©å†…å®¹ */}
      <ScrollView>
        {/* æ¶ˆæ¯åˆ—è¡¨ */}
      </ScrollView>
      
      {/* è¾“å…¥æ¡†å›ºå®šåº•éƒ¨ */}
      <View>
        <TextInput placeholder="è¾“å…¥æ¶ˆæ¯..." />
      </View>
    </KeyboardAvoidingView>
  );
};
```

---

## ğŸ§ª åä¸€ã€æµ‹è¯•ç­–ç•¥

### 11.1 å•å…ƒæµ‹è¯•

```typescript
import { render, fireEvent, waitFor } from '@testing-library/react-native';
import MainPage from '../MainPage';

describe('MainPage', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“ä¸»é¡µé¢', () => {
    const { getByText } = render(<MainPage />);
    expect(getByText('æ¶ˆæ¯')).toBeTruthy();
  });
  
  it('åº”è¯¥æ­£ç¡®å¤„ç†åˆ†ç±»ç‚¹å‡»', async () => {
    const { getByText } = render(<MainPage />);
    const likesCard = getByText('èµå’Œæ”¶è—');
    
    fireEvent.press(likesCard);
    
    await waitFor(() => {
      // éªŒè¯å¯¼èˆªè·³è½¬
    });
  });
  
  it('åº”è¯¥æ­£ç¡®æ˜¾ç¤ºæœªè¯»æ•°é‡', () => {
    const { getByText } = render(<MainPage />);
    // éªŒè¯æœªè¯»è§’æ ‡æ˜¾ç¤º
  });
});
```

### 11.2 é›†æˆæµ‹è¯•

```typescript
describe('Messages Integration', () => {
  it('åº”è¯¥å®Œæˆå®Œæ•´çš„æ¶ˆæ¯æµè§ˆæµç¨‹', async () => {
    // 1. è¿›å…¥æ¶ˆæ¯ä¸»é¡µ
    // 2. ç‚¹å‡»å¯¹è¯
    // 3. æŸ¥çœ‹æ¶ˆæ¯è¯¦æƒ…
    // 4. å‘é€æ¶ˆæ¯
    // 5. è¿”å›ä¸»é¡µ
  });
});
```

---

## ğŸ“Š åäºŒã€ç›‘æ§æŒ‡æ ‡

### 12.1 æ€§èƒ½æŒ‡æ ‡
- **é¦–å±åŠ è½½æ—¶é—´**: < 1s
- **åˆ—è¡¨æ»šåŠ¨å¸§ç‡**: >= 60fps
- **APIå“åº”æ—¶é—´**: < 500ms
- **å†…å­˜å ç”¨**: < 200MB
- **WebSocketè¿æ¥ç¨³å®šæ€§**: > 99%

### 12.2 ä¸šåŠ¡æŒ‡æ ‡
- **æ—¥æ´»è·ƒç”¨æˆ·**: ç›‘æ§
- **æ¶ˆæ¯å‘é€æˆåŠŸç‡**: > 99.5%
- **é€šçŸ¥åˆ°è¾¾ç‡**: > 95%
- **ç”¨æˆ·æ»¡æ„åº¦**: ç›®æ ‡ 4.5/5

### 12.3 è´¨é‡æŒ‡æ ‡
- **å´©æºƒç‡**: < 0.1%
- **ANRç‡**: < 0.05%
- **æ¥å£æˆåŠŸç‡**: > 99.9%

---

## ğŸ“ åä¸‰ã€å®æ–½æ£€æŸ¥æ¸…å•

### âœ… æ¶æ„å®æ–½å®Œæ•´æ€§æ£€æŸ¥

- [ ] **æ–‡ä»¶ç»“æ„å®Œæ•´æ€§**
  - [ ] æ‰€æœ‰æ ¸å¿ƒæ–‡ä»¶å·²åˆ›å»ºï¼ˆindex/types/constants/READMEï¼‰
  - [ ] MainPageå’ŒSubPagesç»“æ„æ­£ç¡®
  - [ ] ComponentAreaNameåˆ’åˆ†åˆç†

- [ ] **å‰åç«¯ä¸€ä½“åŒ–å®Œæ•´æ€§**
  - [ ] å‰ç«¯APIæ¥å£å±‚æ–‡ä»¶å®Œæ•´
  - [ ] åç«¯å®ç°å±‚æ ¸å¿ƒæ–‡ä»¶å®Œæ•´
  - [ ] å‰åç«¯æ•°æ®ç±»å‹å®šä¹‰ä¸€è‡´
  - [ ] MyBatis-Plusé…ç½®æ­£ç¡®

- [ ] **ä»£ç è´¨é‡æ ‡å‡†**
  - [ ] æ‰€æœ‰ä¸»æ–‡ä»¶éµå¾ªå…«æ®µå¼ç»“æ„
  - [ ] çŠ¶æ€ç®¡ç†ç¬¦åˆä¸»æ–‡ä»¶ä¼˜å…ˆåŸåˆ™
  - [ ] ç±»å‹å®šä¹‰å®Œæ•´æ— any
  - [ ] å¸¸é‡å…¨éƒ¨æå–æ— ç¡¬ç¼–ç 

- [ ] **åŠŸèƒ½å®Œæ•´æ€§**
  - [ ] æ ¸å¿ƒåŠŸèƒ½å®ç°å®Œæ•´
  - [ ] é”™è¯¯å¤„ç†è¦†ç›–å…¨é¢
  - [ ] è¾¹ç•Œæƒ…å†µå¤„ç†å®Œå–„
  - [ ] æ€§èƒ½ä¼˜åŒ–å·²å®æ–½

- [ ] **æ–‡æ¡£å®Œæ•´æ€§**
  - [ ] READMEæ–‡æ¡£å®Œæ•´
  - [ ] APIæ–‡æ¡£æ¸…æ™°
  - [ ] ä»£ç æ³¨é‡Šå……åˆ†
  - [ ] ä½¿ç”¨ç¤ºä¾‹å®Œæ•´

---

## ğŸš€ åå››ã€å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šæ¶æ„æ­å»ºï¼ˆç¬¬1-2å¤©ï¼‰
1. åˆ›å»ºé¡µé¢ç»„æ ¹ç›®å½•å’Œæ ¸å¿ƒæ–‡ä»¶
2. å®šä¹‰å®Œæ•´çš„ç±»å‹ç³»ç»Ÿï¼ˆtypes.tsï¼‰
3. é…ç½®æ‰€æœ‰å¸¸é‡ï¼ˆconstants.tsï¼‰
4. ç¼–å†™æ¶æ„æ–‡æ¡£ï¼ˆREADME.mdï¼‰

### ç¬¬äºŒé˜¶æ®µï¼šå‰åç«¯ä¸€ä½“åŒ–å®æ–½ï¼ˆç¬¬3-5å¤©ï¼‰
5. åˆ›å»ºå‰ç«¯APIæ¥å£å±‚æ–‡ä»¶
6. åˆ›å»ºåç«¯å®ç°å±‚æ‰€æœ‰æ–‡ä»¶
7. é…ç½®MyBatis-Pluså’ŒQueryWrapper
8. æµ‹è¯•å‰åç«¯æ•°æ®äº¤äº’

### ç¬¬ä¸‰é˜¶æ®µï¼šä¸»é¡µé¢å®æ–½ï¼ˆç¬¬6-8å¤©ï¼‰
9. å®æ–½MainPageä¸»é¡µé¢
10. å®æ–½NavigationAreaå¯¼èˆªæ åŒºåŸŸ
11. å®æ–½CategoryAreaåˆ†ç±»åŒºåŸŸ
12. å®æ–½ConversationAreaå¯¹è¯åˆ—è¡¨åŒºåŸŸ

### ç¬¬å››é˜¶æ®µï¼šå­é¡µé¢å®æ–½ï¼ˆç¬¬9-12å¤©ï¼‰
13. å®æ–½LikesPageèµå’Œæ”¶è—é¡µé¢
14. å®æ–½CommentsPageè¯„è®ºé¡µé¢
15. å®æ–½FollowersPageç²‰ä¸é¡µé¢
16. å®æ–½NotificationsPageç³»ç»Ÿé€šçŸ¥é¡µé¢
17. å®æ–½ChatPageç§èŠå¯¹è¯é¡µé¢

### ç¬¬äº”é˜¶æ®µï¼šä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆç¬¬13-15å¤©ï¼‰
18. æ€§èƒ½ä¼˜åŒ–å®æ–½
19. å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•
20. ä»£ç å®¡æŸ¥å’Œé‡æ„
21. æ–‡æ¡£å®Œå–„å’Œäº¤ä»˜

---

## ğŸ“Œ åäº”ã€æ³¨æ„äº‹é¡¹

### ğŸš¨ å¼ºåˆ¶æ‰§è¡Œé¡¹
- âœ… å‰åç«¯å¿…é¡»åŒæ—¶å®Œæ•´äº¤ä»˜
- âœ… æ‰€æœ‰ä¸»æ–‡ä»¶å¿…é¡»éµå¾ªå…«æ®µå¼ç»“æ„
- âœ… çŠ¶æ€ç®¡ç†ä¼˜å…ˆåœ¨ä¸»æ–‡ä»¶å†…é›†ä¸­
- âœ… æ•°æ®è®¿é—®å±‚ç»Ÿä¸€ä½¿ç”¨MyBatis-Plus

### âš ï¸ é¿å…çš„é”™è¯¯
- âŒ ä»…åˆ›å»ºå‰ç«¯æ¥å£è€Œå¿½ç•¥åç«¯å®ç°
- âŒ è¿‡åº¦åˆ›å»ºç‹¬ç«‹çš„hooks/utilsæ–‡ä»¶
- âŒ ç¡¬ç¼–ç å¸¸é‡å’Œé­”æ³•æ•°å­—
- âŒ è¿‡åº¦è®¾è®¡æœªä½¿ç”¨çš„æ¥å£

### ğŸ’¡ æœ€ä½³å®è·µ
- âœ… æŒ‰éœ€è®¾è®¡ï¼ŒYAGNIåŸåˆ™
- âœ… ä¸»æ–‡ä»¶å®Œæ•´è‡ªåŒ…å«
- âœ… ä»£ç å¯è¯»æ€§ä¼˜å…ˆ
- âœ… æŒç»­é‡æ„ä¼˜åŒ–

---

**ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¥æœŸ**: 2024å¹´  
**åŸºäºæ ‡å‡†**: UNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.5  
**é€‚ç”¨èŒƒå›´**: XiangYuPaiæ¢åº—APPæ¶ˆæ¯æ¨¡å—
